/*!
 * SharepointPlus v3.0.9
 * Copyright 2014, Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/SharepointPlus/
 * License: GPL v2 (http://aymkdn.github.com/SharepointPlus/license.txt)
 */
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){"use strict";if(this==null){throw new TypeError}var t=Object(this);var n=t.length>>>0;if(n===0){return-1}var r=0;if(arguments.length>1){r=Number(arguments[1]);if(r!=r){r=0}else if(r!=0&&r!=Infinity&&r!=-Infinity){r=(r>0||-1)*Math.floor(Math.abs(r))}}if(r>=n){return-1}var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++){if(i in t&&t[i]===e){return i}}return-1}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}_SP_APPROVED=0;_SP_REJECTED=1;_SP_PENDING=2;_SP_DRAFT=3;_SP_SCHEDULED=4;_SP_CACHE_FORMFIELDS=null;__SP_NOTIFY_READY=false;__SP_NOTIFY_QUEUE=[];__SP_NOTIFY=[];(function(window){function SharepointPlus(){if(!(this instanceof arguments.callee))return new arguments.callee}var fastMap=function(e,t){var n=e.length;var r=new Array(n);var i=n/8;var s=n%8;for(var o=n-1;o>-1;o--){var u=i;var a=s;do{switch(a){case 0:r[o]=t(e[o]);o--;case 7:r[o]=t(e[o]);o--;case 6:r[o]=t(e[o]);o--;case 5:r[o]=t(e[o]);o--;case 4:r[o]=t(e[o]);o--;case 3:r[o]=t(e[o]);o--;case 2:r[o]=t(e[o]);o--;case 1:r[o]=t(e[o]);o--}a=0}while(--u>0)}return r};var decode_b64=function(e,t,n,r,i,s,o){t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(i=s=o="";n=e.charAt(o++);~n&&(r=s%4?r*64+n:n,s++%4)?i+=String.fromCharCode(255&r>>(-2*s&6)):0)n=t.indexOf(n);return i};var encode_b64=function(e,t,n,r,i,s){t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";n="=";for(r=s="";i&=3,e.charAt(r++)||(t="=",i);s+=t.charAt(63&n>>++i*2))n=n<<8|e.charCodeAt(r-=!i);return s};SharepointPlus.prototype={data:[],length:0,listQueue:[],needQueue:false,getVersion:function(){return"3.0.4"},list:function(e,t){this.reset();if(t){if(t.substring(t.length-1,t.length)==="/")t=t.substring(0,t.length-1);this.url=t}else this._getURL();this.listID=e.replace(/&/g,"&");return this},_getURL:function(){if(this.url===undefined&&typeof L_Menu_BaseUrl==="undefined"&&jQuery("body").data("sp-currenturl")===undefined){this.needQueue=true;var e=this;var t="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><WebUrlFromPageUrl xmlns='http://schemas.microsoft.com/sharepoint/soap/' >"+"<pageUrl>"+window.location.href.replace(/&/g,"&")+"</pageUrl></WebUrlFromPageUrl></soap:Body></soap:Envelope>";var n=window.location.protocol+"//"+window.location.host+"/_vti_bin/Webs.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:n,data:t,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){var n=t.getElementsByTagName("WebUrlFromPageUrlResult");if(n.length){e.url=n[0].firstChild.nodeValue.toLowerCase();jQuery("body").data("sp-currenturl",e.url)}e.needQueue=false}})}else this.url=this.url||jQuery("body").data("sp-currenturl")||window.location.protocol+"//"+window.location.host+L_Menu_BaseUrl;return this},_addInQueue:function(e){this.listQueue.push(e);if(this.listQueue.length===1)this._testQueue();return this},_testQueue:function(){if(this.needQueue){var e=this;setTimeout(function(){e._testQueue.call(e)},25)}else{if(this.listQueue.length>0){var t=this.listQueue.shift();t.callee.apply(this,Array.prototype.slice.call(t))}this.needQueue=this.listQueue.length>0;if(this.needQueue){var e=this;setTimeout(function(){e._testQueue.call(e)},25)}}},parse:function(e,t){var n=e.replace(/(\s+)?(=|~=|<=|>=|<>|<|>| LIKE | like )(\s+)?/g,"$2").replace(/""|''/g,"Null").replace(/==/g,"=");var r=[];t=t===false?false:true;var i=e.length;var s="",o="",u=false;var a="";var f={open:0};var l=false;for(var c=0;c<n.length;c++){var h=n.charAt(c);switch(h){case"(":var p=c;var d=false;while(n.charAt(c)=="("&&c<i){c++;f.open++}while(f.open>0&&c<i){c++;var v=n.charAt(c);if(v=="\\")u=true;else if(!u&&v=="'")d=!d;else if(!u&&v==")"&&!d)f.open--;else u=false}var m=r.length-1;if(m>=0){if(s!="")r[0]="<"+s+">"+r[0];r[0]+=this.parse(n.substring(p+1,c));if(s!="")r[0]+="</"+s+">";s=""}else r[0]=this.parse(n.substring(p+1,c));break;case">":case"<":c++;if(n.charAt(c)=="="){r.push("<"+(h==">"?"G":"L")+"eq>");o="</"+(h==">"?"G":"L")+"eq>"}else if(h=="<"&&n.charAt(c)==">"){r.push("<Neq>");o="</Neq>"}else{c--;r.push("<"+(h==">"?"G":"L")+"t>");o="</"+(h==">"?"G":"L")+"t>"}break;case"~":if(n.charAt(c+1)=="=")l=true;break;case"=":r.push("<Eq>");o="</Eq>";break;case" ":if(n.substring(c,c+5).toUpperCase()==" AND "){s="And";c+=4}else if(n.substring(c,c+4).toUpperCase()==" OR "){s="Or";c+=3}else if(n.slice(c,c+6).toUpperCase()==" LIKE "){c+=5;r.push("<Contains>");o="</Contains>"}else a+=h;break;case'"':case"'":var g=h;var y="",b="";while((h=n.charAt(++c))!=g&&c<i){if(h=="\\")h=n.charAt(++c);y+=h}m=r.length-1;r[m]+='<FieldRef Name="'+a+'" '+(y=="[Me]"?'LookupId="True" ':"")+"/>";a="";var w="Text";if(/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})?/.test(y)){w="DateTime";if(/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})/.test(y))b=' IncludeTimeValue="TRUE"'}if(t)y=this._cleanString(y);if(y==="[Me]"){y='<UserID Type="Integer" />';w="Integer"}else if(y.slice(0,6)=="[Today"){w="DateTime";y='<Today OffsetDays="'+1*y.slice(6,-1)+'" />'}r[m]+='<Value Type="'+w+'"'+b+">"+y+"</Value>";r[m]+=o;o="";if(m>0){if(s!="")r[0]="<"+s+">"+r[0];r[0]+=r[m];if(s!="")r[0]+="</"+s+">";delete r[m];s=""}break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(o!=""){var E=h;while(!isNaN(h=n.charAt(++c))&&c<i)E+=""+h;m=r.length-1;r[m]+='<FieldRef Name="'+a+'"'+(l?' LookupId="True"':"")+" />";a="";r[m]+='<Value Type="'+(l?"Integer":"Number")+'">'+E.replace(/ $/,"")+"</Value>";r[m]+=o;o="";if(m>0){if(s!="")r[0]="<"+s+">"+r[0];r[0]+=r[m];if(s!="")r[0]+="</"+s+">";delete r[m];s=""}c-=2;break};default:if(o=="")a+=h;else if(h.toLowerCase()=="n"&&n.substring(c,c+4).toLowerCase()=="null"){m=r.length-1;if(o=="</Neq>"){r[m]="<IsNotNull>";o="</IsNotNull>"}else if(o=="</Eq>"){r[m]="<IsNull>";o="</IsNull>"}c+=3;r[m]+='<FieldRef Name="'+a+'" />';a="";r[m]+=o;o="";if(m>0){if(s!="")r[0]="<"+s+">"+r[0];r[0]+=r[m];if(s!="")r[0]+="</"+s+">";delete r[m];s=""}}}}return r.join("")},_parseOn:function(e){var t=[];var n=e.replace(/(\s+)?(=)(\s+)?/g,"$2").replace(/==/g,"=").split(" AND ");for(var r=0;r<n.length;r++){var i=n[r].match(/'([^']+)'\.([a-zA-Z0-9_]+)='([^']+)'\.([a-zA-Z0-9_]+)/);if(i&&i.length==5){var s={};s[i[1]]=i[2];s[i[3]]=i[4];t.push(s)}}return t},_cleanString:function(e){return e.replace(/&(?!amp;|lt;|gt;)/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;")},cleanResult:function(e,t){if(e===null||typeof e==="undefined")return"";t=t||";";return typeof e==="string"?e.replace(/;#[0-9]+;#/g,t).replace(/^[0-9]+;#/,"").replace(/^;#|;#$/g,"").replace(/;#/g,t).replace(/string;#/,""):e},get:function(e,t){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined)throw"Error 'get': you have to define the list ID/Name";if(arguments.length===1&&typeof e==="function")return this.get({},e);e=e||{};if(this.url==undefined)throw"Error 'get': not able to find the URL!";e.fields=e.fields||"";e.where=e.where||"";e.whereFct=e.whereFct||function(e){return e};e.orderby=e.orderby||"";e.groupby=e.groupby||"";e.rowlimit=e.rowlimit||0;e.whereEscapeChar=e.whereEscapeChar===false?false:true;e.paging=e.paging===true?true:false;if(e.paging&&e.rowlimit===0)e.rowlimit=5e3;e.expandUserField=e.expandUserField===true||e.expandUserField==="True"?"True":"False";e.dateInUTC=e.dateInUTC===true?"True":"False";e.folderOptions=e.folderOptions||null;e.view=e.view||"";e.calendar=e.calendar===true?true:false;if(e.calendar===true){e.calendarOptions=e.calendarOptions||{};e.calendarOptions.referenceDate=e.calendarOptions.referenceDate||new Date;if(typeof e.calendarOptions.referenceDate!=="string")e.calendarOptions.referenceDate=this.toSPDate(e.calendarOptions.referenceDate);e.calendarOptions.splitRecurrence=e.calendarOptions.splitRecurrence===false?"FALSE":"TRUE";e.calendarOptions.range=e.calendarOptions.range||"Month"}e.results=e.results||[];e.ListItemCollectionPositionNext=e.ListItemCollectionPositionNext||"";if(typeof e.where==="object"){if(e.originalWhere==undefined)e.originalWhere=e.where.slice(0);e.nextWhere=e.where.slice(1);e.where=e.where.shift()}else{e.originalWhere=e.where;e.nextWhere=[]}e.progress=e.progress||function(){};if(e.view!==""){if(e.view.charAt(0)!=="{"){var n=this;n.view(e.view,function(r,i){e.view=i;e.fields;var s=e.whereCAML?e.where:n.parse(e.where);var o=r.whereCAML.match(/^<And>(<DateRangesOverlap>.*<\/DateRangesOverlap>)(.*)<\/And>$/);if(o&&o.length===3)r.whereCAML="<And>"+o[2]+o[1]+"</And>";s+=r.whereCAML;if(e.where!==""&&r.whereCAML!=="")s="<And>"+s+"</And>";e.where=s;e.fields+=(e.fields===""?"":",")+r.fields.join(",");e.orderby+=(e.orderby===""?"":",")+r.orderby;e.whereCAML=true;e.useOWS=true;e.calendarViaView=e.calendar;e.calendar=false;delete e.view;return n.get.call(n,e,t)});return this}if(e.whereCAML!==true){e.where=this.parse(e.where,e.whereEscapeChar);e.whereCAML=true}}var r=true;var i="";if(e.fields==""||e.fields==[])i="";else{if(typeof e.fields=="string")e.fields=e.fields.replace(/^\s+/,"").replace(/\s+$/,"").replace(/( )?,( )?/g,",").split(",");for(var s=0;s<e.fields.length;s++)i+='<FieldRef Name="'+e.fields[s]+'" />'}var o="";if(e.orderby!=""){var u=e.orderby.split(",");for(s=0;s<u.length;s++){var a="ASC";var f=jQuery.trim(u[s]).split(" ");if(f.length>0){if(f.length==2)a=f[1].toUpperCase();o+=r?'<FieldRef Name="'+f[0]+'" Ascending="'+(a=="ASC")+'" />':'<OrderField Name="'+f[0]+'" Direction="'+a+'" />'}}}if((e.calendar===true||e.calendarViaView===true)&&o==="")o='<FieldRef Name="EventDate" Ascending="ASC" />';var l="";if(e.groupby!=""){var c=e.groupby.split(",");for(s=0;s<c.length;s++)l+='<FieldRef Name="'+c[s]+'" />'}if(e.calendar===true||e.calendarViaView===true){var h=["Title","EventDate","EndDate","Duration","fAllDayEvent","fRecurrence","RecurrenceData","ID"];for(s=0;s<h.length;s++)i+='<FieldRef Name="'+h[s]+'" />'}var p="";var d=[];if(e.queryOptions===undefined){e._queryOptions="<DateInUtc>"+e.dateInUTC+"</DateInUtc>"+'<Paging ListItemCollectionPositionNext="'+e.ListItemCollectionPositionNext+'"></Paging>'+"<IncludeAttachmentUrls>True</IncludeAttachmentUrls>"+(i===""?"":"<IncludeMandatoryColumns>False</IncludeMandatoryColumns>")+"<ExpandUserField>"+e.expandUserField+"</ExpandUserField>";if(e.folderOptions){var v;switch(e.folderOptions.show){case"FilesAndFolders_Recursive":v="RecursiveAll";break;case"FilesOnly_InFolder":v="FilesOnly";break;case"FilesAndFolders_InFolder":v="";break;case"FilesOnly_Recursive":default:v="Recursive"}e._queryOptions+='<ViewAttributes Scope="'+v+'"></ViewAttributes>';if(e.folderOptions.path)e._queryOptions+="<Folder>"+this.url+"/"+this.listID+"/"+e.folderOptions.path+"</Folder>"}else e._queryOptions+='<ViewAttributes Scope="Recursive"></ViewAttributes>'}else e._queryOptions=e.queryOptions;if(e.calendarOptions){e._queryOptions+="<CalendarDate>"+e.calendarOptions.referenceDate+"</CalendarDate>"+"<RecurrencePatternXMLVersion>v3</RecurrencePatternXMLVersion>"+"<ExpandRecurrence>"+e.calendarOptions.splitRecurrence+"</ExpandRecurrence>"}var m="";if(e.where!==""){if(e.whereCAML)m=e.where;else m=this.parse(e.where)}if(e.calendar===true){var g="<DateRangesOverlap>"+"<FieldRef Name='EventDate' />"+"<FieldRef Name='EndDate' />"+"<FieldRef Name='RecurrenceID' />"+"<Value Type='DateTime'><"+e.calendarOptions.range+" /></Value>"+"</DateRangesOverlap>";if(m!=="")m="<And>"+m+g+"</And>";else m=g}m=e.whereFct(m);var n=this;if(r){p='<?xml version="1.0" encoding="utf-8"?>'+'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+'xmlns:xsd="http://www.w3.org/2001/XMLSchema" '+'xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<listName>"+this.listID+"</listName>"+"<viewName>"+e.view+"</viewName>"+"<query>"+"<Query>"+(m!=""?"<Where>"+m+"</Where>":"")+(l!=""?"<GroupBy>"+l+"</GroupBy>":"")+(o!=""?"<OrderBy>"+o+"</OrderBy>":"")+"</Query>"+"</query>"+"<viewFields>"+"<ViewFields Properties='True'>"+i+"</ViewFields>"+"</viewFields>"+"<rowLimit>"+e.rowlimit+"</rowLimit>"+"<queryOptions>"+"<QueryOptions>"+e._queryOptions+"</QueryOptions>"+"</queryOptions>"+"</GetListItems>"+"</soap:Body>"+"</soap:Envelope>";var y=this.url+"/_vti_bin/Lists.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:y,data:p,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){var i=r.getElementsByTagName("z:row");if(i.length==0)i=r.getElementsByTagName("row");d=fastMap(i,function(e){return myElem(e)});if(e.joinData){var s=e.joinData["noindex"];var o=[];var u="";var a={length:0};if(!s.length)alert("$SP.get() -- Error 'get': you must define the ON clause with JOIN is used.");for(var f=0,l=d.length;f<l;f++){var c="";for(var h=0;h<s.length;h++)c+=d[f].getAttribute(s[h][n.listID]);if(e.joinData[c]){if(u!==c){a[e.joinIndex[c]]=true;a.length++;u=c}for(var h=0,p=e.joinData[c].length;h<p;h++){var v=[];var m=d[f].getAttributes();for(var g=m.length;g--;){v[n.listID+"."+m[g].nodeName.slice(4)]=m[g].nodeValue}var y=e.joinData[c][h].getAttributes();for(var g in y){v[g]=e.joinData[c][h].getAttribute(g)}o.push(new extendMyObject(v))}}if(e.innerjoin)e.join=e.innerjoin;if(e.outerjoin){e.join=e.outerjoin;e.join.outer=true}}d=o;if(e.outer){var b=e.joinIndex.length;if(a.length<b){for(f=0;f<b;f++){if(a[f]!==true){var w=e.joinIndex[f];if(w===undefined||e.joinData[w]===undefined)continue;for(var h=0,p=e.joinData[w].length;h<p;h++){var v=[];var y=e.joinData[w][h].getAttributes();for(var g in y){v[g]=e.joinData[w][h].getAttribute(g)}o.push(new extendMyObject(v))}}}}}}if(e.outerjoin){e.join=e.outerjoin;e.join.outer=true}else if(e.innerjoin)e.join=e.innerjoin;if(e.join){var E=[],S=[];var s=n._parseOn(e.join.on);E["noindex"]=s;for(var f=0,l=d.length;f<l;f++){var c="",v=[];for(var h=0;h<s.length;h++)c+=d[f].getAttribute(s[h][n.listID])||d[f].getAttribute(n.listID+"."+s[h][n.listID]);if(!E[c]){S[c]=S.length;S.push(c);E[c]=[]}if(e.joinData){E[c].push(d[f])}else{var x=d[f].getAttributes();for(var h=x.length;h--;){v[n.listID+"."+x[h].nodeName.slice(4)]=x[h].nodeValue}E[c].push(new extendMyObject(v))}}delete e.joinData;var T=$SP().list(e.join.list,e.join.url||n.url);e.join.joinData=E;e.join.joinIndex=S;T.get(e.join,t)}else{if(e.results.length>0)for(var f=0,l=d.length;f<l;f++)e.results.push(d[f]);if(typeof e.originalWhere!=="string")e.progress(e.originalWhere.length-e.nextWhere.length,e.originalWhere.length);if(e.paging){var N=r.getElementsByTagName("rs:data")[0];if(N.length==0)N=r.getElementsByTagName("data");if(e.results.length===0)e.results=d;var C=N.getAttribute("ListItemCollectionPositionNext");if(C){e.ListItemCollectionPositionNext=n._cleanString(N.getAttribute("ListItemCollectionPositionNext"));n.get(e,t)}else{if(typeof t=="function")t.call(n,e.results)}}else if(e.nextWhere.length>0){if(e.results.length===0)e.results=d;e.where=e.nextWhere.slice(0);n.get(e,t)}else if(typeof t=="function"){e.where=e.originalWhere;t.call(n,e.results.length>0?e.results:d)}}},error:function(e,r,i){var s=e.responseXML;var o=s.getElementsByTagName("errorstring");if(o&&o[0])t.call(n,[],"Error: "+o[0].firstChild.nodeValue);else t.call(n,[],r+": "+i)}})}return this},createFile:function(e){e=e||{};if(e.content==undefined)throw"Error 'createFile': not able to find the file content.";if(e.destination==undefined)throw"Error 'createFile': not able to find the file destination path.";e.url=e.url||this.url;if(!e.url){this._getURL();return this._addInQueue(arguments)}if(e.url==undefined)throw"Error 'createFile': not able to find the URL!";e.after=e.after||function(){};e.encoded=e.encoded==undefined?false:e.encoded;var t=this;var n='<?xml version="1.0" encoding="utf-8"?>'+'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<CopyIntoItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<SourceUrl>http://null</SourceUrl>"+"<DestinationUrls><string>"+e.destination+"</string></DestinationUrls>"+"<Fields><FieldInformation Type='File' /></Fields>"+"<Stream>"+(e.encoded?e.content:encode_b64(e.content))+"</Stream>"+"</CopyIntoItems>"+"</soap:Body>"+"</soap:Envelope>";jQuery.ajax({url:e.url+"/_vti_bin/copy.asmx",type:"POST",dataType:"xml",data:n,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CopyIntoItems")},contentType:'text/xml; charset="utf-8"',success:function(n){var r=n.getElementsByTagName("CopyResult");if(r&&r[0]&&r[0].getAttribute("ErrorCode")!="Success")throw"Error 'createFile': "+r[0].getAttribute("ErrorCode")+" - "+r[0].getAttribute("ErrorMessage");if(typeof e.after=="function")e.after.call(t)}});return this},createFolder:function(e){e=e||{};if(e.path==undefined)throw"Error 'createFolder': please provide the 'path'.";if(e.library==undefined)throw"Error 'createFolder': please provide the library name.";e.url=e.url||this.url;if(!e.url){this._getURL();return this._addInQueue(arguments)}if(e.url==undefined)throw"Error 'createFolder': not able to find the URL!";e.after=e.after||function(){};var t=e.path.split("/"),n=[],r="";for(var i=0;i<t.length;i++){r+=(i>0?"/":"")+t[i];n.push({FSObjType:1,BaseName:r})}this.list(e.library,e.url).add(n,{after:e.after});return this},checkin:function(e){e=e||{};if(e.destination==undefined)throw"Error 'checkin': not able to find the file destination path.";e.url=e.url||this.url;if(!e.url){this._getURL();return this._addInQueue(arguments)}if(this.url==undefined)throw"Error 'checkin': not able to find the URL!";e.url=this.url;e.comments=e.comments||"";e.success=e.success||function(){};e.error=e.error||function(){};e.after=e.after||function(){};var t=this;var n='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+'<soap:Body><CheckInFile xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<pageUrl>"+e.destination+"</pageUrl>"+"<comment>"+e.comments+"</comment>"+"<CheckinType>1</CheckinType></CheckInFile></soap:Body></soap:Envelope>";jQuery.ajax({url:e.url+"/_vti_bin/Lists.asmx",type:"POST",dataType:"xml",data:n,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CheckInFile")},contentType:"text/xml; charset=utf-8",success:function(n){var r=n.getElementsByTagName("CheckInFileResult");if(r&&r[0]&&r[0].firstChild.nodeValue!="true")e.error.call(t);else e.success.call(t);e.after.call(t)}})},getAttachment:function(e,t,n){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined)throw"Error 'getAttachment': you have to define the list ID/Name";if(arguments.length===1&&typeof e==="function")throw"Error 'getAttachment': you have to define the item ID";if(this.url==undefined)throw"Error 'getAttachment': not able to find the URL!";if(typeof e!=="object")e=e.split(",");n=n||[];var r='<?xml version="1.0" encoding="utf-8"?>'+'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+'xmlns:xsd="http://www.w3.org/2001/XMLSchema" '+'xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+" <soap:Body>"+' <GetAttachmentCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+" <listName>"+this.listID+"</listName>"+" <listItemID>"+e.shift()+"</listItemID>"+" </GetAttachmentCollection>"+" </soap:Body>"+"</soap:Envelope>";var i=this;var s=this.url+"/_vti_bin/lists.asmx";var o=[];jQuery.ajax({type:"POST",cache:false,async:true,url:s,data:r,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetAttachmentCollection")},dataType:"xml",success:function(r){var s=r.getElementsByTagName("Attachment");for(var u=0;u<s.length;u++)o.push(s[u].firstChild.nodeValue);if(o.length===0)o="";else if(o.length===1)o=o[0];n.push(o);if(e.length===0){if(typeof t==="function")t.call(i,n)}else{i.getAttachment(e,t,n)}}});return this},info:function(e){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined)throw"Error 'info': you have to define the list ID";if(this.url==undefined)throw"Error 'info': not able to find the URL!";var t='<?xml version="1.0" encoding="utf-8"?>';t+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';t+="  <soap:Body>";t+='    <GetList xmlns="http://schemas.microsoft.com/sharepoint/soap/">';t+="      <listName>"+this.listID+"</listName>";t+="    </GetList>";t+="  </soap:Body>";t+="</soap:Envelope>";var n=this;var r=this.url+"/_vti_bin/lists.asmx";var i=[];jQuery.ajax({type:"POST",cache:false,async:true,url:r,data:t,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetList")},dataType:"xml",success:function(t){var r=t.getElementsByTagName("Field");var s=0,o,u,a,f;for(var l=0;l<r.length;l++){if(r[l].getAttribute("ID")){i[s]=[];o=i[s];u=r[l].attributes;for(var c=u.length;c--;){a=u[c].nodeName;attrValue=u[c].nodeValue;if(a==="Type"){switch(attrValue){case"Choice":case"MultiChoice":{o["FillInChoice"]=r[l].getAttribute("FillInChoice");var h=r[l].getElementsByTagName("CHOICE");var p=[];for(var d=0;d<h.length;d++)p.push(h[d].firstChild.nodeValue);o["Choices"]=p;break};case"Lookup":case"LookupMulti":o["Choices"]={list:r[l].getAttribute("List"),field:r[l].getAttribute("ShowField")};break;default:o["Choices"]=[]}}o[a]=attrValue}f=r[l].getElementsByTagName("Default").length;if(f>0){nodeDefault=r[l].getElementsByTagName("Default");i[s]["DefaultValue"]=[];for(var v=0;v<f;v++)nodeDefault[v].firstChild&&i[s]["DefaultValue"].push(nodeDefault[v].firstChild.nodeValue);if(f===1)i[s]["DefaultValue"]=i[s]["DefaultValue"][0]}else i[s]["DefaultValue"]=null;s++}}if(typeof e=="function")e.call(n,i)}});return this},view:function(e,t){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined)throw"Error 'view': you have to define the list ID/Name";if(arguments.length===1&&typeof e==="function")return this.view("",e);list=this.listID;if(this.url==undefined)throw"Error 'view': not able to find the URL!";e=e||"";var n=arguments[2]||e;n=n.toLowerCase();var r=jQuery("body").data("sp-view");if(r!=undefined){for(var i=r.length;i--;){if(r[i].url===this.url&&(r[i].viewID===e||r[i].viewName===n)){t.call(this,r[i].data,e);return this}}}else r=[];if(e.charAt(0)!=="{"){this.views(function(n){var r=false;for(var i=n.length;i--;){if(n[i]["Name"]===e){this.view(n[i]["ID"],t,e);r=true;break}}if(!r)throw"Error 'view': not able to find the view called '"+e+"' at "+this.url});return this}var s='<?xml version="1.0" encoding="utf-8"?>';s+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';s+="  <soap:Body>";s+='    <GetView xmlns="http://schemas.microsoft.com/sharepoint/soap/">';s+="      <listName>"+this.listID+"</listName>";s+="      <viewName>"+e+"</viewName>";s+="    </GetView>";s+="  </soap:Body>";s+="</soap:Envelope>";var o=this.url+"/_vti_bin/Views.asmx";var u=["fields","orderby","whereCAML"];var a=this;jQuery.ajax({type:"POST",cache:false,async:true,url:o,data:s,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetView")},dataType:"xml",success:function(i){u.fields=[];var s=i.getElementsByTagName("ViewFields")[0].getElementsByTagName("FieldRef");for(var o=0;o<s.length;o++)u.fields.push(s[o].getAttribute("Name"));u.orderby="";s=i.getElementsByTagName("OrderBy");if(s.length){var f=[];s=s[0].getElementsByTagName("FieldRef");for(var o=0;o<s.length;o++)f.push(s[o].getAttribute("Name")+" "+(s[o].getAttribute("Ascending")==undefined?"ASC":"DESC"));u.orderby=f.join(",")}u.whereCAML="";var l=i.getElementsByTagName("Where");if(l.length){l=l[0].xml||(new XMLSerializer).serializeToString(l[0]);l=l.match(/<Where [^>]+>(.*)<\/Where>/);if(l.length==2)u.whereCAML=l[1]}r.push({url:a.url,data:u,viewID:e,viewName:n});jQuery("body").data("sp-view",r);if(typeof t=="function")t.call(a,u,e)}});return this},views:function(e){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined)throw"Error 'views': you have to define the list ID";if(this.url==undefined)throw"Error 'views': not able to find the URL!";e=e||function(){};var t=jQuery("body").data("sp-views");if(t!=undefined){for(var n=t.length;n--;){if(t[n].url==this.url){e.call(this,t[n].data);return this}}}else t=[];var r='<?xml version="1.0" encoding="utf-8"?>';r+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';r+="  <soap:Body>";r+='    <GetViewCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">';r+="      <listName>"+this.listID+"</listName>";r+="    </GetViewCollection>";r+="  </soap:Body>";r+="</soap:Envelope>";var i=this.url+"/_vti_bin/Views.asmx";var s=[];var o=this;jQuery.ajax({type:"POST",cache:false,async:true,url:i,data:r,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection")},dataType:"xml",success:function(n){var r=n.getElementsByTagName("View");for(var i=0;i<r.length;i++){s[i]=[];s[i]["ID"]=r[i].getAttribute("Name");s[i]["Name"]=r[i].getAttribute("DisplayName");s[i]["Url"]=r[i].getAttribute("Url");s[i]["Node"]=r[i]}t.push({url:o.url,data:s});jQuery("body").data("sp-views",t);e.call(o,s)}});return this},lists:function(e,t){if(arguments.length===1&&typeof e==="function")return this.lists({},e);e=e||{};e.url=e.url||this.url;if(!e.url){this._getURL();return this._addInQueue(arguments)}else this.url=e.url;if(this.url==undefined)throw"Error 'lists': not able to find the URL!";var n='<?xml version="1.0" encoding="utf-8"?>';n+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';n+="  <soap:Body>";n+='    <GetListCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">';n+="    </GetListCollection>";n+="  </soap:Body>";n+="</soap:Envelope>";var r=jQuery("body").data("sp-lists");if(r!=undefined){for(var i=r.length;i--;){if(r[i].url==this.url){if(typeof t=="function")t(r[i].data);else{this.data=r[i].data;this.length=this.data.length}return this}}}else r=[];var s=this.url+"/_vti_bin/lists.asmx";var o=[];var u=this;jQuery.ajax({type:"POST",cache:false,async:true,url:s,data:n,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListCollection")},dataType:"xml",success:function(e){var n=e.getElementsByTagName("List");for(var i=0;i<n.length;i++){o[i]=[];o[i]["ID"]=n[i].getAttribute("ID");o[i]["Name"]=n[i].getAttribute("Title");o[i]["Url"]=n[i].getAttribute("DefaultViewUrl");o[i]["Description"]=n[i].getAttribute("Description")}r.push({url:u.url,data:o});jQuery("body").data("sp-lists",r);if(typeof t=="function")t.call(u,o)}});return this},add:function(e,t){if(this.needQueue){return this._addInQueue(arguments)}if(arguments.length===0||arguments.length===1&&typeof e!=="object")throw"Error 'add': you need to define the list of items";if(this.listID===undefined)throw"Error 'add': you need to use list() to define the list name.";t=t||{};if(this.url==undefined)throw"Error 'add': not able to find the URL!";t.success=t.success||function(){};t.error=t.error||function(){};t.after=t.after||function(){};t.escapeChar=t.escapeChar==undefined?true:t.escapeChar;t.progress=t.progress||function(){};if(typeof e==="object"&&e.length==undefined)e=[e];var n=e.length;t.progressVar=t.progressVar||{current:0,max:n,passed:[],failed:[],eventID:"spAdd"+(""+Math.random()).slice(2)};if(n>15){var r=e.slice(0);var i=r.splice(0,15);var s=this;jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID);s.add(r,e.setup)});this.add(i,t);return this}else if(n==0){t.progress(1,1);t.error([]);t.success([]);t.after();return this}t.progressVar.current+=n;var o='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var s=this;for(var u=0;u<e.length;u++){o+='<Method ID="'+(u+1)+'" Cmd="New">';o+="<Field Name='ID'>New</Field>";jQuery.each(e[u],function(e,n){if(typeof n==="object"&&n.items!=undefined)n=";#"+n.join(";#")+";#";if(t.escapeChar&&typeof n==="string")n=s._cleanString(n);o+="<Field Name='"+e+"'>"+n+"</Field>"});o+="</Method>"}o+="</Batch>";var a='<?xml version="1.0" encoding="utf-8"?>'+'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<listName>"+this.listID+"</listName>"+"<updates>"+o+"</updates>"+"</UpdateListItems>"+"</soap:Body>"+"</soap:Envelope>";var f=this.url+"/_vti_bin/lists.asmx";var s=this;jQuery.ajax({type:"POST",cache:false,async:true,url:f,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var r=n.getElementsByTagName("Result");var i=r.length;var o=t.progressVar.passed,u=t.progressVar.failed;for(var a=0;a<i;a++){if(r[a].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){var f=r[a].getElementsByTagName("z:row");if(f.length==0)f=r[a].getElementsByTagName("row");e[a].ID=f[0].getAttribute("ows_ID");o.push(e[a])}else{e[a].errorMessage=r[a].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;u.push(e[a])}}t.progress(t.progressVar.current,t.progressVar.max);if(t.progressVar.current<t.progressVar.max)jQuery(document).trigger({type:t.progressVar.eventID,setup:t});else{if(u.length>0)t.error.call(s,u);if(o.length>0)t.success.call(s,o);t.after.call(s)}}});return this},update:function(e,t){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID===undefined)throw"Error 'update': you need to use list() to define the list name.";t=t||{};if(this.url==undefined)throw"Error 'update': not able to find the URL!";t.where=t.where||"";t.success=t.success||function(){};t.error=t.error||function(){};t.after=t.after||function(){};t.escapeChar=t.escapeChar==undefined?true:t.escapeChar;t.progress=t.progress||function(){};if(typeof e==="object"&&e.length==undefined)e=[e];var n=e.length;if(n==1&&t.where){delete e[0].ID;var r=this;this.get({fields:"ID",where:t.where},function(n){var i=function(e){var t={};for(var n in e)t[n]=e[n];return t};var s=[];for(var o=n.length;o--;){var u=i(e[0]);u.ID=n[o].getAttribute("ID");s.push(u)}delete t.where;r.update(s,t)});return this}t.progressVar=t.progressVar||{current:0,max:n,passed:[],failed:[],eventID:"spUpdate"+(""+Math.random()).slice(2)};if(n>15){var i=e.slice(0);var s=i.splice(0,15);var r=this;jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID);r.update(i,e.setup)});this.update(s,t);return this}else if(n==0){t.progress(1,1);t.error([]);t.success([]);t.after();return this}t.progressVar.current+=n;var o='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var r=this;for(var u=0;u<n;u++){o+='<Method ID="'+(u+1)+'" Cmd="Update">';if(e[u].ID==undefined)throw"Error 'update': you have to provide the item ID called 'ID'";jQuery.each(e[u],function(e,n){if(typeof n==="object"&&n.length!=undefined)n=";#"+n.join(";#")+";#";if(t.escapeChar&&typeof n==="string")n=r._cleanString(n);o+="<Field Name='"+e+"'>"+n+"</Field>"});o+="</Method>"}o+="</Batch>";var a='<?xml version="1.0" encoding="utf-8"?>'+'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<listName>"+this.listID+"</listName>"+"<updates>"+o+"</updates>"+"</UpdateListItems>"+"</soap:Body>"+"</soap:Envelope>";var f=this.url+"/_vti_bin/lists.asmx";var r=this;jQuery.ajax({type:"POST",cache:false,async:true,url:f,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var i=n.getElementsByTagName("Result");var s=i.length;var o=t.progressVar.passed,u=t.progressVar.failed;for(var a=0;a<s;a++){if(i[a].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000")o.push(e[a]);else{e[a].errorMessage=i[a].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;u.push(e[a])}}t.progress(t.progressVar.current,t.progressVar.max);if(t.progressVar.current<t.progressVar.max)jQuery(document).trigger({type:t.progressVar.eventID,setup:t});else{if(u.length>0)t.error.call(r,u);if(o.length>0)t.success.call(r,o);t.after.call(r)}}});return this},history:function(e,t){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID===undefined)throw"Error 'history': you need to use list() to define the list name.";if(arguments.length!==2)throw"Error 'history': you need to provide two parameters.";if(typeof e!=="object")throw"Error 'history': the first parameter must be an object.";else{if(e.ID===undefined||e.Name===undefined)throw"Error 'history': the first parameter must be an object with ID and Name."}if(typeof t!=="function")throw"Error 'history': the second parameter must be a function.";var n='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+'<soap:Body><GetVersionCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<strlistID>"+this.listID+"</strlistID>"+"<strlistItemID>"+e.ID+"</strlistItemID>"+"<strFieldName>"+e.Name+"</strFieldName>"+"</GetVersionCollection></soap:Body></soap:Envelope>";var r=this.url+"/_vti_bin/lists.asmx";var i=this;jQuery.ajax({type:"POST",cache:false,async:true,url:r,data:n,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetVersionCollection")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){t.call(i,e.getElementsByTagName("Version"))}});return this},moderate:function(e,t){if(this.needQueue){return this._addInQueue(arguments)}if(arguments.length===0||arguments.length===1&&typeof e==="object"&&e.length===undefined)throw"Error 'moderate': you need to define the list of items";if(this.listID===undefined)throw"Error 'moderate': you need to use list() to define the list name.";t=t||{};if(this.url==undefined)throw"Error 'moderate': not able to find the URL!";t.async=t.async==undefined?true:t.async;t.success=t.success||function(){};t.error=t.error||function(){};t.after=t.after||function(){};t.progress=t.progress||function(){};if(typeof e==="object"&&e.length==undefined)e=[e];var n=e.length;t.progressVar=t.progressVar||{current:0,max:n,passed:[],failed:[],eventID:"spModerate"+(""+Math.random()).slice(2)};if(n>15){var r=e.slice(0);var i=r.splice(0,15);var s=this;jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID);s.moderate(r,e.setup)});this.moderate(i,t);return this}else if(n==0){t.progress(1,1);t.success([]);t.error([]);t.after();return this}t.progressVar.current+=n;var o='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var u=this;for(var a=0;a<n;a++){o+='<Method ID="'+(a+1)+'" Cmd="Moderate">';if(e[a].ID==undefined)throw"Error 'moderate': you have to provide the item ID called 'ID'";else if(e[a].ApprovalStatus==undefined)throw"Error 'moderate': you have to provide the approval status 'ApprovalStatus' (Approved, Rejected, Pending, Draft or Scheduled)";jQuery.each(e[a],function(e,t){if(e=="ApprovalStatus"){e="_ModerationStatus";switch(t.toLowerCase()){case"approve":case"approved":t=0;break;case"reject":case"deny":case"denied":case"rejected":t=1;break;case"pending":t=2;break;case"draft":t=3;break;case"scheduled":t=4;break;default:t=2;break}}o+="<Field Name='"+e+"'>"+t+"</Field>"});o+="</Method>"}o+="</Batch>";var f='<?xml version="1.0" encoding="utf-8"?>'+'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<listName>"+this.listID+"</listName>"+"<updates>"+o+"</updates>"+"</UpdateListItems>"+"</soap:Body>"+"</soap:Envelope>";var l=this.url+"/_vti_bin/lists.asmx";var s=this;jQuery.ajax({type:"POST",cache:false,async:true,url:l,data:f,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var r=n.getElementsByTagName("Result");var i=r.length;var o=t.progressVar.passed,u=t.progressVar.failed;var a;for(var f=0;f<i;f++){a=r[f].getElementsByTagName("z:row");if(a.length==0)a=n.getElementsByTagName("row");var l=myElem(a[0]);if(r[f].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000")o.push(l);else{e[f].errorMessage=r[f].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;u.push(e[f])}}t.progress(t.progressVar.current,t.progressVar.max);if(t.progressVar.current<t.progressVar.max)jQuery(document).trigger({type:t.progressVar.eventID,setup:t});else{if(o.length>0)t.success.call(s,o);if(u.length>0)t.error.call(s,u);t.after.call(s)}}});return this},remove:function(e,t){if(this.needQueue){return this._addInQueue(arguments)}if(!t&&e.where){t=e;e=[]}t=t||{};if(this.url==undefined)throw"Error 'remove': not able to find the URL!";t.error=t.error||function(){};t.success=t.success||function(){};t.after=t.after||function(){};t.progress=t.progress||function(){};if(typeof e==="object"&&e.length==undefined)e=[e];var n=e.length;if(t.where){if(n==1)delete e[0].ID;var r=this;this.get({fields:"ID,FileRef",where:t.where},function(n){var i=function(e){var t={};for(var n in e)t[n]=e[n];return t};var s=[],o;for(var u=n.length;u--;){var a=i(e[0]);a.ID=n[u].getAttribute("ID");o=n[u].getAttribute("FileRef");if(o)a.FileRef=$SP().cleanResult(o);s.push(a)}delete t.where;r.remove(s,t)});return this}else if(n==0){t.progress(1,1);t.error.call(r,[]);t.success.call(r,[]);t.after.call(r);return r}t.progressVar=t.progressVar||{current:0,max:n,passed:[],failed:[],eventID:"spRemove"+(""+Math.random()).slice(2)};if(n>15){var i=e.slice(0);var s=i.splice(0,15);var r=this;jQuery(document).on(t.progressVar.eventID,function(e){jQuery(document).off(t.progressVar.eventID);r.remove(i,e.setup)});this.remove(s,t);return this}t.progressVar.current+=n;var o='<Batch OnError="Continue" ListVersion="1"  ViewName="">';for(var u=0;u<e.length;u++){o+='<Method ID="'+(u+1)+'" Cmd="Delete">';if(e[u].ID==undefined)throw"Error 'delete': you have to provide the item ID called 'ID'";o+="<Field Name='ID'>"+e[u].ID+"</Field>";if(e[u].FileRef!=undefined)o+="<Field Name='FileRef'>"+e[u].FileRef+"</Field>";o+="</Method>"}o+="</Batch>";var a='<?xml version="1.0" encoding="utf-8"?>'+'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">'+"<listName>"+this.listID+"</listName>"+"<updates>"+o+"</updates>"+"</UpdateListItems>"+"</soap:Body>"+"</soap:Envelope>";var r=this;var f=this.url+"/_vti_bin/lists.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:f,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var i=n.getElementsByTagName("Result");var s=i.length;var o=t.progressVar.passed,u=t.progressVar.failed;for(var a=0;a<s;a++){if(i[a].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000")o.push(e[a]);else{e[a].errorMessage=i[a].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;u.push(e[a])}}t.progress(t.progressVar.current,t.progressVar.max);if(t.progressVar.current<t.progressVar.max)jQuery(document).trigger({type:t.progressVar.eventID,setup:t});else{if(u.length>0)t.error.call(r,u);if(o.length>0)t.success.call(r,o);t.after.call(r)}}});return this},del:function(e,t){return this.remove(e,t)},usergroups:function(e,t,n){switch(arguments.length){case 1:if(typeof e==="object")return this.usergroups("",e,function(){});else if(typeof e==="function")return this.usergroups("",{},e);break;case 2:if(typeof e==="string"&&typeof t==="function")return this.usergroups(e,{},t);if(typeof e==="object"&&typeof t==="function")return this.usergroups("",e,t)}t=t||{};t.cache=t.cache===false?false:true;if(t.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else t.url=this.url}else this.url=t.url;n=n||function(){};if(!e)throw"Error 'usergroups': you have to set an username.";e=e.toLowerCase();t.url=t.url.toLowerCase();var r=jQuery("body").data("sp-usergroups")||[];if(t.cache){for(var i=r.length;i--;){if(r[i].user.toLowerCase()==e&&r[i].url.toLowerCase()==t.url){n.call(this,r[i].data);return this}}}var s="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"+"<soap:Body><GetGroupCollectionFromUser xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'>"+"<userLoginName>"+e+"</userLoginName>"+"</GetGroupCollectionFromUser></soap:Body></soap:Envelope>";var o=this;var u=t.url+"/_vti_bin/usergroup.asmx";jQuery.ajax({type:"POST",cache:false,url:u,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetGroupCollectionFromUser")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){var s=[];i=i.getElementsByTagName("Group");for(var u=0,a=i.length;u<a;u++)s.push(i[u].getAttribute("Name"));r.push({user:e,url:t.url,data:s});jQuery("body").data("sp-usergroups",r);n.call(o,s)},error:function(e,r,i){if(t.error===false)n.call(o,[]);else{var s=e.responseXML.getElementsByTagName("errorstring");if(typeof console==="object")console.error("Error 'usergroups': "+s[0].firstChild.nodeValue)}}});return this},getWorkflowID:function(e){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined)throw"Error 'getWorkflowID': you have to define the list ID/Name";if(this.url==undefined)throw"Error 'getWorkflowID': not able to find the URL!";e=e||{};if(e.ID==undefined||e.workflowName==undefined||e.after==undefined)throw"Error 'getWorkflowID': all parameters are mandatory";this.get({fields:"FieldRef",where:"ID = "+e.ID},function(t){if(t.length===0)throw"Error 'getWorkflowID': I'm not able to find the item ID "+e.ID;var n=this.cleanResult(t[0].getAttribute("FileRef"));var r=n.substring(0,n.indexOf("/Lists"));var t=this.url.substring(0,this.url.indexOf(r));n=t+n;var i='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+'<soap:Body><GetWorkflowDataForItem xmlns="http://schemas.microsoft.com/sharepoint/soap/workflow/">'+"<item>"+n+"</item>"+"</GetWorkflowDataForItem></soap:Body></soap:Envelope>";var s=this;jQuery.ajax({type:"POST",cache:false,async:true,url:this.url+"/_vti_bin/Workflow.asmx",data:i,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/GetWorkflowDataForItem")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){var r=t.getElementsByTagName("WorkflowTemplate");if(r.length===0)throw"Error 'getWorkflowID': No workflow found for this item";for(var i=r.length;i--;){if(r[i].getAttribute("Name")==e.workflowName){e.after.call(s,{fileRef:n,workflowID:"{"+r[i].getElementsByTagName("WorkflowTemplateIdSet")[0].getAttribute("TemplateId")+"}"});return s}}e.after.call(s,"Error 'getWorkflowID': impossible to find this workflow name!")},error:function(e,t,n){throw"Error 'getWorkflowID': Something went wrong with the request over the Workflow Web Service..."}})});return this},startWorkflow:function(e){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined)throw"Error 'startWorkflow': you have to define the list ID/Name";if(this.url==undefined)throw"Error 'startWorkflow': not able to find the URL!";e=e||{};e.after=e.after||function(){};if(!e.workflowName&&!e.workflowID)throw"Error 'startWorkflow': Please provide the workflow name!";if(!e.ID)throw"Error 'startWorkflow': Please provide the item ID!";if(!e.fileRef&&!e.workflowID){this.getWorkflowID({ID:e.ID,workflowName:e.workflowName,after:function(t){e.fileRef=t.fileRef;e.workflowID=t.workflowID;this.startWorkflow(e)}})}else{var t="<root />";if(e.parameters){var n;if(e.parameters.length==undefined)e.parameters=[e.parameters];n=e.parameters.slice(0);t="<Data>";for(var r=0;r<n.length;r++)t+="<"+n[r].name+">"+n[r].value+"</"+n[r].name+">";t+="</Data>"}var i='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+'<soap:Body><StartWorkflow xmlns="http://schemas.microsoft.com/sharepoint/soap/workflow/">'+"<item>"+e.fileRef+"</item>"+"<templateId>"+e.workflowID+"</templateId>"+"<workflowParameters>"+t+"</workflowParameters></StartWorkflow>"+"</soap:Body></soap:Envelope>";var s=this;var o=this.url+"/_vti_bin/Workflow.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:o,data:i,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/StartWorkflow")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){e.after.call(s)},error:function(t,n,r){e.after.call(s)}})}return this},distributionLists:function(e,t,n){switch(arguments.length){case 1:if(typeof e==="object")return this.distributionLists("",e,function(){});else if(typeof e==="function")return this.distributionLists("",{},e);break;case 2:if(typeof e==="string"&&typeof t==="function")return this.distributionLists(e,{},t);if(typeof e==="object"&&typeof t==="function")return this.distributionLists("",e,t)}t=t||{};if(t.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else t.url=this.url}else this.url=t.url;n=n||function(){};if(!e)throw"Error 'distributionLists': you have to set an username.";e=e.toLowerCase();t.url=t.url.toLowerCase();t.cache=t.cache===false?false:true;var r=jQuery("body").data("sp-distributionLists")||[];if(t.cache){for(var i=r.length;i--;){if(r[i].user===e&&r[i].url===t.url){n.call(this,r[i].data);return this}}}var s="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"+"<soap:Body><GetCommonMemberships xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'>"+"<accountName>"+e+"</accountName></GetCommonMemberships></soap:Body></soap:Envelope>";var o=this;var u=t.url+"/_vti_bin/UserProfileService.asmx";jQuery.ajax({type:"POST",cache:false,url:u,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserMemberships")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){var s=[];i=i.getElementsByTagName("MembershipData");for(var u=0,a=i.length;u<a;u++){if(i[u].getElementsByTagName("Source")[0].firstChild.nodeValue==="DistributionList")s.push({SourceReference:i[u].getElementsByTagName("SourceReference")[0].firstChild.nodeValue,DisplayName:i[u].getElementsByTagName("DisplayName")[0].firstChild.nodeValue,MailNickname:i[u].getElementsByTagName("MailNickname")[0].firstChild.nodeValue,Url:i[u].getElementsByTagName("Url")[0].firstChild.nodeValue})}r.push({user:e,url:t.url,data:s});jQuery("body").data("sp-distributionLists",r);n.call(o,s)},error:function(e,t,r){n.call(o,[])}});return this},groupMembers:function(e,t,n){switch(arguments.length){case 1:if(typeof e==="object")return this.groupMembers("",e,function(){});else if(typeof e==="function")return this.groupMembers("",{},e);break;case 2:if(typeof e==="string"&&typeof t==="function")return this.groupMembers(e,{},t);if(typeof e==="object"&&typeof t==="function")return this.groupMembers("",e,t)}t=t||{};t.cache=t.cache===undefined?true:t.cache;if(t.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else t.url=this.url}else this.url=t.url;n=n||function(){};if(!e)throw"Error 'groupMembers': you have to set an groupname.";e=e.toLowerCase();t.url=t.url.toLowerCase();var r=[];if(t.cache){r=jQuery("body").data("sp-groupMembers")||[];for(var i=r.length;i--;){if(r[i].group===e&&r[i].url===t.url){n.call(this,r[i].data);return this}}}var s="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"+"<soap:Body><GetUserCollectionFromGroup xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'>"+"<groupName>"+this._cleanString(e)+"</groupName></GetUserCollectionFromGroup></soap:Body></soap:Envelope>";var o=this;var u=t.url+"/_vti_bin/usergroup.asmx";jQuery.ajax({type:"POST",cache:false,url:u,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetUserCollectionFromGroup")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){var s=[];i=i.getElementsByTagName("User");for(var u=0,a=i.length;u<a;u++)s.push({ID:i[u].getAttribute("ID"),Name:i[u].getAttribute("Name"),LoginName:i[u].getAttribute("LoginName"),Email:i[u].getAttribute("Email")});r.push({group:e,url:t.url,data:s});jQuery("body").data("sp-groupMembers",r);n.call(o,s)},error:function(e,r,i){if(t.error===false)n.call(o,[]);else{var s=e.responseXML.getElementsByTagName("errorstring");if(typeof console==="object")console.error("Error 'groupMembers': "+s[0].firstChild.nodeValue)}}});return this},isMember:function(e,t){e=e||{};e.cache=e.cache===false?false:true;if(e.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else e.url=this.url}else this.url=e.url;t=t||function(){};if(!e.user)throw"Error 'isMember': you have to set an user.";if(!e.group)throw"Error 'isMember': you have to set a group.";e.group=e.group.toLowerCase();this.usergroups(e.user,{cache:e.cache,error:false},function(n){for(var r=n.length;r--;){if(n[r].toLowerCase()===e.group){t.call(this,true);return this}}this.groupMembers(e.group,{cache:e.cache,error:false},function(n){var r=[];for(var i=n.length;i--;)r.push(n[i].Name.toLowerCase());this.distributionLists(e.user,{cache:e.cache},function(e){for(var n=e.length;n--;){if(r.indexOf(e[n].DisplayName.toLowerCase())>-1){t.call(this,true);return this}}t.call(this,false);return this})})});return this},people:function(e,t,n){switch(arguments.length){case 1:if(typeof e==="object")return this.people("",e,function(){});else if(typeof e==="function")return this.people("",{},e);e=undefined;break;case 2:if(typeof e==="string"&&typeof t==="function")return this.people(e,{},t);if(typeof e==="object"&&typeof t==="function")return this.people("",e,t)}t=t||{};if(t.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else t.url=this.url}else this.url=t.url;n=n||function(){};e=e||"";var r="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"+"<soap:Body><GetUserProfileByName xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'>"+"<AccountName>"+e+"</AccountName>"+"</GetUserProfileByName></soap:Body></soap:Envelope>";var i=this;var s=t.url+"/_vti_bin/UserProfileService.asmx";jQuery.ajax({type:"POST",cache:false,url:s,data:r,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserProfileByName")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PropertyData");for(var r=0,s=e.length;r<s;r++){var o=e[r].getElementsByTagName("Name")[0].firstChild.nodeValue;var u=e[r].getElementsByTagName("Value");if(u&&u.length>=1)u=u[0].firstChild.nodeValue;else u="No Value";t.push(o);t[o]=u}n.call(i,t)},error:function(e,t,r){var s=e.responseXML.getElementsByTagName("faultstring");n.call(i,"Error 'people': "+s[0].firstChild.nodeValue)}});return this},getUserInfo:function(e,t,n){if(typeof e!=="string")throw"Error 'getUserInfo': the first argument must be the username";switch(arguments.length){case 2:if(typeof t==="function")return this.getUserInfo(e,{},t);if(typeof t==="object")return this.getUserInfo(e,t,function(){});break;case 3:if(typeof t!=="object"&&typeof n!=="function")throw"Error 'getUserInfo': incorrect arguments, please review the documentation"}t=t||{};if(t.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else t.url=this.url}else this.url=t.url;n=n||function(){};var r='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+'<soap:Body><GetUserInfo xmlns="http://schemas.microsoft.com/sharepoint/soap/directory/">'+"<userLoginName>"+e+"</userLoginName></GetUserInfo></soap:Body></soap:Envelope>";var i=this;var s=t.url+"/_vti_bin/usergroup.asmx";jQuery.ajax({type:"POST",cache:false,url:s,data:r,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("User");if(e.length===0)n.call(i,"Error 'getUserInfo': nothing returned?!");else n.call(i,{ID:e[0].getAttribute("ID"),Sid:e[0].getAttribute("Sid"),Name:e[0].getAttribute("Name"),LoginName:e[0].getAttribute("LoginName"),Email:e[0].getAttribute("Email"),Notes:e[0].getAttribute("Notes"),IsSiteAdmin:e[0].getAttribute("IsSiteAdmin"),IsDomainGroup:e[0].getAttribute("IsDomainGroup"),Flags:e[0].getAttribute("Flags")})},error:function(e,t,r){var s=e.responseXML.getElementsByTagName("errorstring");n.call(i,"Error 'getUserInfo': "+s[0].firstChild.nodeValue)}});return this},whoami:function(e,t){if(typeof e==="function"){t=e;e={}}return this.people("",e,t)},addressbook:function(e,t,n){switch(arguments.length){case 1:if(typeof e==="object")return this.addressbook("",e,function(){});else if(typeof e==="function")return this.addressbook("",{},e);else if(typeof e==="string")return this.addressbook(e,{},function(){});e=undefined;break;case 2:if(typeof e==="string"&&typeof t==="function")return this.addressbook(e,{},t);if(typeof e==="object"&&typeof t==="function")return this.addressbook("",e,t)}t=t||{};if(t.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else t.url=this.url}else this.url=t.url;t.limit=t.limit||10;t.type=t.type||"User";n=n||function(){};e=e||"";var r="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"+"<soap:Body><SearchPrincipals xmlns='http://schemas.microsoft.com/sharepoint/soap/'>"+"<searchText>"+e+"</searchText><maxResults>"+t.limit+"</maxResults><principalType>"+t.type+"</principalType></SearchPrincipals></soap:Body></soap:Envelope>";var i=this;var s=t.url+"/_vti_bin/People.asmx";jQuery.ajax({type:"POST",cache:false,url:s,data:r,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PrincipalInfo");for(var r=0,s=e.length;r<s;r++){var o=e[r].childNodes;t[r]=[];for(var u=0,a=o.length;u<a;u++){var f=o[u].nodeName;var l=o[u].firstChild;if(l)l=l.nodeValue;t[r].push(f);t[r][f]=l}}n.call(i,t)}});return this},reset:function(){this.data=[];this.length=0;this.listID="";this.needQueue=false;this.listQueue=[];delete this.url},toDate:function(e){if(e instanceof Date)return e;if(e.length!=19&&e.length!=20)throw"toDate: '"+e+"' is invalid.";var t=e.substring(0,4);var n=e.substring(5,7);var r=e.substring(8,10);var i=e.substring(11,13);var s=e.substring(14,16);var o=e.substring(17,19);return e.indexOf("Z")>-1?new Date(Date.UTC(t,n-1,r,i,s,o)):new Date(t,n-1,r,i,s,o)},toSPDate:function(e,t){var n=function(e){if(e.toString().length==1){e="0"+e}return e};var r=n(e.getMonth()+1);var i=n(e.getDate());var s=e.getFullYear();var o=n(e.getHours());var u=n(e.getMinutes());var a=n(e.getSeconds());return s+"-"+r+"-"+i+(t?" "+o+":"+u+":"+a:"")},toCurrency:function(e,t,n){e=Number(e);if(t===undefined)t=-1;if(n===undefined)n="$";var r="";if(e<0){r="-";e*=-1}var i=e;if(t===-1)i=i.toFixed(2).replace(".00","");else i=i.toFixed(t);var s=(Math.floor(e)+"").length;for(var o=0,u=0,a=s%3;o<s;o++){if(o==0||o%3!=a)continue;i=i.substr(0,o+u)+","+i.substr(o+u);u++}return(n!=""?n:"")+r+i+(n!=""?"":" "+n)},getLookup:function(e){if(!e){return{id:"",value:""}}var t=e.split(";#");return{id:t[0],value:t[1]}},toXSLString:function(e){if(typeof e!=="string")throw"Error 'toXLSString': '"+e+"' is not a string....";var t=function(e,t){t=t||false;var n=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");var r="";for(var i=0;i<e.length;i++){var s=e.charAt(i);var o=s.charCodeAt(0);var u=0;var a="";while(o>=16){u=o%16;o=Math.floor(o/16);a+=n[u]}a+=n[o];var f="";for(var l=a.length-1;l>=0;l--)f+=a.charAt(l);r+="%"+f}return r};var n=e.split(" ");var r="";if(/^[0-9]/.test(n[0])&&n[0].length<5){r=t(e.charAt(0));e=e.substring(1)}for(var i=0;i<e.length;i++){var s=e.charAt(i);if(/[0-9A-Za-z_]/.test(s)===false)r+=t(s).toLowerCase();else r+=s}return r.replace(/%([a-zA-Z0-9][a-zA-Z0-9])/g,"_x00$1_").substring(0,32)},formfields:function(fields,settings){"use strict";this.reset();if(arguments.length==1&&typeof fields==="object"&&typeof fields.length==="undefined"){settings=fields;fields=undefined}settings=settings||{};fields=fields||[];settings.cache=settings.cache===false?false:true;var aReturn=[],bigLimit=1e4;if(typeof fields==="string")fields=fields===""?[]:fields.split(",");var limit=fields.length>0?fields.length:bigLimit;if(limit===bigLimit&&!settings.mandatory)settings.includeAll=true;if(settings.cache&&_SP_CACHE_FORMFIELDS!==null){var allFields=_SP_CACHE_FORMFIELDS.slice(0);if(settings.includeAll){this.length=allFields.length;this.data=allFields;return this}var done=0,i,len=allFields.length,idx;var fieldNames=[];for(i=0;i<len;i++)fieldNames.push(allFields[i]._name);for(i=0;i<limit;i++){idx=fieldNames.indexOf(fields[i]);if(idx>-1)aReturn.push(allFields[idx])}for(i=0,len=settings.mandatory?allFields.length:0;i<len;i++){if(allFields[i]._isMandatory&&fields.indexOf(allFields[i]._name)===-1)aReturn.push(allFields[i])}this.length=aReturn.length;this.data=aReturn;return this}if(settings.cache)settings.includeAll=true;var selectorSupported=typeof document.querySelector!=="undefined";var table=null;if(!selectorSupported){for(var a=document.getElementsByTagName("table"),i=0,len=a.length;i<len;i++)if(a[i].className.indexOf("ms-formtable")>-1){table=a[i];break}}else table=document.querySelector("table.ms-formtable");if(!table)throw"Error: unable to find the table.ms-formtable!";var closestTR=function(e){var t=e;do{t=t.parentNode}while(t.tagName.toLowerCase()!=="tr");return t};var getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9||r===11){if(typeof e.textContent==="string")return e.textContent;else if(typeof e.innerText==="string"){return e.innerText.replace(/\r/g,"")}else{for(e=e.firstChild;e;e=e.nextSibling)i+=getText(e)}}else if(r===3||r===4)return e.nodeValue}else{for(t=0;n=e[t];t++){if(n.nodeType!==8)i+=getText(n)}}return i};if(settings.includeAll)limit=bigLimit;for(var a=table.getElementsByTagName("nobr"),i=-1,len=a.length,done=0;i<len&&done<limit;i++){var nobr,tr,isMandatory=false,html,txt,includeThisField=false;var search;if(settings.includeAll)includeThisField=true;if(i===-1){if(includeThisField||fields.indexOf("Content Type")>-1){txt=html="Content Type";includeThisField=true}}else{tr=undefined;nobr=a[i];if(nobr.parentNode.tagName.toUpperCase()!=="H3")continue;html=nobr.innerHTML;txt=getText(nobr);if(html.indexOf("ms-formvalidation")>-1){html=html.slice(0,-39);if(html.charAt(html.length-2)=="<"&&(html.charAt(html.length-1)=="s"||html.charAt(html.length-1)=="S"))html=html.slice(0,-2);if(settings.mandatory)includeThisField=true;txt=txt.slice(0,-2);isMandatory=true}if(limit!==bigLimit){for(var k=0,lenk=limit;k<lenk;k++){if(fields[k].trim()===txt){includeThisField=true;done++;break}}}}if(includeThisField){var fieldName=txt;var obj={_name:fieldName,_isMandatory:isMandatory,_description:"",_elements:null,_tr:null,_type:null};if(fieldName==="Content Type"){if(selectorSupported)obj._elements=document.querySelector('.ms-formbody select[title="Content Type"]');else{for(var a=document.getElementsByTagName("td"),aa=0;aa<a.length;aa++){if(a[aa].className.indexOf("ms-formbody")>-1){for(var b=document.getElementsByTagName("select"),bb=0;bb<b.length;bb++){if(b[bb].title==="Content Type"){aa=a.length;obj._elements=b[bb];break}}}}}obj._type="content type";if(obj._elements)obj._tr=closestTR(obj._elements);else continue}else{obj._tr=tr===undefined?closestTR(nobr):tr}obj.val=function(){};obj.elem=function(){return this._elements};obj.description=function(){return this._description};obj.type=function(){return this._type};obj.row=function(){return this._tr};obj.name=function(){return this._name};obj.isMandatory=function(){return this._isMandatory};obj.options=function(){};tr=obj._tr.length?obj._tr[0]:obj._tr;var td=tr.getElementsByTagName("td")[1].getElementsByTagName("span")[0];var elem=[];if(obj._name==="Attachments"){obj._type="attachments";elem=td.getElementsByTagName("tr")}else if(obj._name==="Content Type"){elem=[obj._elements]}else{var input=td.getElementsByTagName("input");var continueToSearch=false;for(var inp=0;inp<input.length;inp++){if(input[inp].getAttribute("data-sp-ignore")!=="true"){var type=input[inp].getAttribute("type");switch(type){case"text":if(input[inp].className.indexOf("ms-input")>-1||input[inp].className.indexOf("ms-long")>-1){elem.push(input[inp]);if(!obj._type)obj._type="text";if(input[inp].id.search(/DateTimeFieldDate$/)>-1){continueToSearch=true;obj._type="date"}else if(input[inp].id.search(/_UrlFieldUrl$|_UrlFieldDescription$/)>-1){obj._type="url";elem.pop();elem.push(input[inp].previousElementSibling||input[inp].previousSibling);elem.push(input[inp])}else inp=input.length}else if(input[inp].title.indexOf("Specify your own value:")>-1){elem.push(input[inp]);if(obj._type.slice(0,7)==="choices")obj._type+=" plus"}break;case"radio":if(input[inp].id.search(/_DropDownButton$/)>-1){obj._type="choices plus";do{elem.push(input[inp]);if(!inp)elem.push("")}while(++inp<input.length);continueToSearch=true}else{elem.push(input[inp]);elem.push(input[inp].nextSibling);obj._type="choices radio"}break;case"checkbox":elem.push(input[inp]);if(input[inp].id.search(/_BooleanField$/)>-1)obj._type="boolean";else obj._type="choices checkbox";if(obj._type!=="boolean")elem.push(input[inp].nextSibling);break}}}if(elem.length===0||continueToSearch){var select=td.getElementsByTagName("select");for(inp=0;inp<select.length;inp++){if(select[inp].className.indexOf("ms-RadioText")>-1||select[inp].id.search(/_cbRate$|_Lookup$|_SelectResult$|_SelectCandidate$|_DateTimeFieldDateHours$|_DateTimeFieldDateMinutes$/)>-1){if(select[inp].id.search(/_SelectCandidate$|_SelectResult$|_DateTimeFieldDateHours$|_DateTimeFieldDateMinutes$/)>-1){if(select[inp].id.indexOf("DateTimeField")>-1)obj._type="date time";elem.push(select[inp]);if(select[inp].id.indexOf("_SelectCandidate")>-1){var buttons=td.getElementsByTagName("button");if(buttons.length===2){elem.push(buttons[0]);elem.push(buttons[1]);obj._type="lookup multiple"}}}else{if(continueToSearch){if(obj._type==="choices plus")elem[1]=select[inp];else elem.push(select[inp])}else{elem.push(select[inp]);if(select[inp].id.search(/_Lookup$/)>-1)obj._type="lookup";else if(!obj._type)obj._type="choices"}break}}}}if(elem.length===0){var other=td.getElementsByTagName("div");for(inp=0;inp<other.length;inp++){if(other[inp].className.indexOf("ms-inputuserfield")>-1){elem.push(other[inp]);obj._type="people";break}}other=td.getElementsByTagName("textarea");for(inp=0;inp<other.length;inp++){if(other[inp].className.indexOf("ms-long")>-1||other[inp].className.indexOf("ms-input")>-1){elem.push(other[inp]);if(!obj._type)obj._type="text multiple";else if(obj._type==="people"){other=td.getElementsByTagName("a");for(inp=0;inp<other.length;inp++)elem.push(other[inp]);break}other=other[inp].nextSibling;if(other&&other.className&&other.className.indexOf("ms-rtetoolbarmenu")>-1){elem=td.getElementsByTagName("iframe")}else{other=td.getElementsByTagName("span");for(inp=other.length;inp--;){if(other[inp].className.indexOf("ms-formdescription")>-1){elem.push(other[inp]);break}}break}}}}if(td.nextSibling){var descro=td.nextSibling;if(descro.nodeType==3)obj._description=getText(descro).trim()}}obj._elements=elem;switch(obj.type()){case"attachments":{obj.val=function(e){if(e)alert("$SP.formfields Error: You cannot define a value for the Attachments");else{var t=this.elem();var n=[];for(e=0;e<t.length;e++)n.push(getText(t[e]).slice(0,-6).trim());return n}};break};case"date":case"text":case"text multiple":{obj.val=function(e){var t=this.elem();var n=this.type();if(t[0].tagName.toLowerCase()==="iframe"){var r=t.length===1?t[0]:t[1];var i=r.contentDocument?r.contentDocument:r.contentWindow.document;if(e)i.getElementsByTagName("div")[0].innerHTML=e;else return i.getElementsByTagName("div")[0].innerHTML}else{if(e!==undefined){if(n==="text"||n==="date")t[0].value=e;else t[0].innerHTML=e}else return t[0].value}return this};break};case"date time":{obj.val=function(e){var t=[];var n=this.elem();if(e!==undefined){if(typeof e==="string")e=[e];n[0].value=e[0];for(var r=1;r<3;r++){if(e[r]){var i=n[r].getElementsByTagName("option");for(var s=i.length;s--;){if(i[s].value===e[r])i[s].selected=true}}}}else{for(var s=0;s<n.length;s++){if(n[s].tagName.toLowerCase()==="input")t.push(n[s].value);else{var i=n[s].getElementsByTagName("option");for(var o=i.length;o--;){if(i[o].selected){t.push(i[o].value);break}}}}return t}return this};break};case"url":{obj.val=function(e){if(e!==undefined){if(typeof e==="string")e=[e,e];else if(e.length===1)e=[e[0],e[0]]}var t=[];var n=this.elem();for(var r=0,i=0;r<n.length;r++){if(n[r].tagName.toLowerCase()==="input"){if(e!==undefined)n[r].value=e[i++];else t.push(n[r].value)}}return e!==undefined?this:t};break};case"boolean":{obj.val=function(e){if(typeof e==="boolean"){this.elem()[0].checked=e;return this}else return this.elem()[0].checked};break};case"people":{obj.val=function(e){var t=this.elem();if(e!==undefined){t[0].innerHTML=e;t[1].value=e;return this}else{e=t[0].innerHTML.replace(/(<([^>]+)>)/ig,"").replace(/^\s+|\s+$|&#160;/g,"").replace(/<br>|&nbsp;/g,"").replace(/;$/,"").split(";");var n=[];for(var r=0;r<e.length;r++){e[r]=e[r].trim();if(e[r]!=="")n.push(e[r])}if(n.length===1)return n[0];if(n.length===0)return"";return n}};break};case"content type":{obj.val=function(v){var e=this.elem();var options=e[0].getElementsByTagName("option");for(var i=0;i<options.length;i++){if(v==options[i].value||v==options[i].innerHTML){options[i].selected=true;eval("!function() {"+e[0].getAttribute("onchange").replace(/javascript:/,"")+"}()");return this}if(!v&&options[i].selected)return options[i].innerHTML}return this};obj.options=function(){var e=[];var t=this.elem();var n=t[0].getElementsByTagName("option");for(var r=0;r<n.length;r++)e.push(n[r].value+";#"+n[r].innerHTML);return e};break};case"lookup":case"choices":case"choices plus":{obj.val=function(e){var t=this.elem();var n=this.type();var r=n.slice(-4)==="plus"?t[1].getElementsByTagName("option"):t[0].getElementsByTagName("option");for(var i=0;i<r.length;i++){if(e==r[i].value||e==r[i].innerHTML){r[i].selected=true;if(n==="choices plus")t[0].checked=true;return this}if(e===undefined&&r[i].selected){if(n==="lookup"||n==="choices"||n==="choices plus"&&t[0].checked)return r[i].innerHTML}}if(n==="choices plus"&&t.length===4){if(e!==undefined){t[2].checked=true;t[3].value=e}else if(t[2].checked)return t[3].value}};obj.options=function(){var e=[];var t=this.elem();var n=this.type();var r=n.slice(-4)==="plus"?t[1].getElementsByTagName("option"):t[0].getElementsByTagName("option");for(var i=0;i<r.length;i++)e.push(r[i].value+(n==="lookup"?";#"+r[i].innerHTML:""));if(n==="choices plus"&&t.length===4&&t[3].value!="")e.push(t[3].value);return e};break};case"lookup multiple":{obj.val=function(v){var e=this.elem();var type=this.type();var options,i;if(typeof v==="string")v=[v];if(v!==undefined){var optValues=[],optText=[],idx;options=e[3].getElementsByTagName("option");for(i=0;i<options.length;i++)options[i].selected=true;eval("!function() {"+e[2].getAttribute("onclick")+"}()");options=e[0].getElementsByTagName("option");for(idx=0;idx<options.length;idx++)options[idx].selected=false;for(i=0;i<v.length;i++){for(idx=0;idx<options.length;idx++){if(options[idx].innerHTML==v[i]||options[idx].value==v[i]){options[idx].selected=true;eval("!function() {"+e[1].getAttribute("onclick")+"}()");options=e[0].getElementsByTagName("option");break}}}return this}else{var ret=[];options=e[3].getElementsByTagName("option");for(i=0;i<options.length;i++)ret.push(options[i].innerHTML);return ret}};obj.options=function(){var e=[];var t=this.elem();var n=t[0].getElementsByTagName("option");for(i=0;i<n.length;i++)e.push(n[i].value+";#"+n[i].innerHTML);n=t[3].getElementsByTagName("option");for(i=0;i<n.length;i++)e.push(n[i].value+";#"+n[i].innerHTML);return e};break};case"choices radio":case"choices radio plus":case"choices checkbox":case"choices checkbox plus":{obj.val=function(e){var t=this.elem();var n=this.type();var r=[],i=[];if(typeof e==="string")e=[e];for(var s=0;s<t.length;s++){if(e!==undefined&&t[s].tagName.toLowerCase()==="label"&&e.indexOf(t[s].innerHTML)>-1){t[s-1].checked=true;i.push(t[s].innerHTML);if(n.slice(0,13)==="choices radio")return this}else if(e!==undefined&&t[s].tagName.toLowerCase()==="label")t[s-1].checked=false;else if(e===undefined&&t[s].checked){if(n==="choices radio plus"){if(t[s+1].innerHTML==="Specify your own value:")return t[s+2].value;return t[s+1].innerHTML}else r.push(t[s+1].innerHTML==="Specify your own value:"?t[s+2].value:t[s+1].innerHTML)}}if(e===undefined)return r;if(e!==undefined){if(n==="choices radio plus"){t[t.length-3].checked=true;t[t.length-1].value=e}else if(n==="choices checkbox plus"){var o=[];for(var s=e.length;s--;){if(i.indexOf(e[s])===-1)o.push(e[s])}if(o.length>0){t[t.length-3].checked=true;t[t.length-1].value=o.join(" ")}}return this}};obj.options=function(){var e=this.elem();var t=[];var n=this.type().slice(-4);for(var r=0;r<e.length;r++){if(e[r].tagName.toLowerCase()==="label"){if(e[r].innerHTML==="Specify your own value:"&&n==="plus")continue;t.push(e[r].innerHTML)}else if(n==="plus"&&e[r].type==="text"&&e[r].value!="")t.push(e[r].value)}return t};break}}aReturn.push(obj)}}if(settings.cache){_SP_CACHE_FORMFIELDS=aReturn.slice(0);settings.includeAll=false;return this.formfields(fields,settings)}else{this.length=aReturn.length;this.data=aReturn;return this}},each:function(e){for(var t=0,n=this.data.length;t<n;t++)e.call(this.data[t]);return this},val:function(e){if(typeof e==="object"&&e.identity!==undefined){identity=e.identity;e=undefined}else identity=false;if(e===undefined){var t=[];this.each(function(){if(identity)t[this.name()]=this.val();else t.push(this.val())});return t.length===1?t[0]:t}else if(typeof e!=="object"){this.each(function(){this.val(e)})}else{var n=0;if(this.length>1){if(e.length!==this.length)throw new Error("$SP.formfields.val: the array passed for val() must have the same size as the number of fields in formfields()");this.each(function(){this.val(e[n++])})}else this.each(function(){this.val(e)})}return this},elem:function(){var e=[];var t=typeof jQuery==="function";this.each(function(){var t=this.elem();e.push(t.length===1?t[0]:t)});switch(e.length){case 0:return t?jQuery():null;case 1:return t?jQuery(e[0]):e[0];default:return t?jQuery(e):e}},row:function(){var e=[];var t=typeof jQuery==="function";this.each(function(){e.push(this.row())});switch(e.length){case 0:return null;case 1:return t?jQuery(e[0]):e[0];default:return t?jQuery(e):e}},type:function(){var e=[];this.each(function(){e.push(this.type())});switch(e.length){case 0:return"";case 1:return e[0];default:return e}},description:function(){var e=[];this.each(function(){e.push(this.description())});switch(e.length){case 0:return"";case 1:return e[0];default:return e}},notify:function(e,t){if(e===undefined)throw"Error 'notify': you must provide the message to show.";if(typeof e!=="string")throw"Error 'notify': you must provide a string for the message to show.";t=t||{};t.timeout=!isNaN(t.timeout)?t.timeout:5;t.override=t.override===true?true:false;t.overrideAll=t.overrideAll===true?true:false;t.overrideSticky=t.overrideSticky===false?false:true;t.sticky=t.sticky===true?true:false;t.name=t.name||(new Date).getTime();t.after=t.after||function(){};t.fake=t.fake===true?true:false;t.ignoreQueue=t.ignoreQueue===true?true:false;if(__SP_NOTIFY_READY===false){__SP_NOTIFY_QUEUE.push({message:e,options:t});$(document).ready(function(){ExecuteOrDelayUntilScriptLoaded(function(){ExecuteOrDelayUntilScriptLoaded(function(){__SP_NOTIFY_READY=true;$SP().notify("fake",{fake:true})},"core.js")},"sp.js")});return this}else{if(t.ignoreQueue!==true){while(__SP_NOTIFY_QUEUE.length>0){var n=__SP_NOTIFY_QUEUE.shift();n.options.ignoreQueue=true;$SP().notify(n.message,n.options)}}if(t.fake===true)return;if(__SP_NOTIFY.length>0){if(t.overrideAll)$SP().removeNotify({all:true,includeSticky:t.overrideSticky});else if(t.override)$SP().removeNotify(__SP_NOTIFY[__SP_NOTIFY.length-1].name)}__SP_NOTIFY.push({name:t.name,id:SP.UI.Notify.addNotification(e,true),options:t})}if(!t.sticky){var r=this;setTimeout(function(){$SP().removeNotify(t.name,{timeout:true})},t.timeout*1e3)}return this},removeNotify:function(e,t){switch(arguments.length){case 0:throw"Error 'removeNotify': you must provide 'name' or 'options'.";case 2:{if(typeof t!=="object")throw"Error 'removeNotify': you must provide an object for 'options'."}}if(arguments.length===1&&typeof e==="object"){t=e;e=undefined}t=t||{all:false};t.timeout=t.timeout===true?true:false;if(__SP_NOTIFY_READY===false&&__SP_NOTIFY_QUEUE.length>0){setTimeout(function(){$SP().removeNotify(e,t)},150);return this}var n,r=this;if(t.all===true){var i=[];while(__SP_NOTIFY.length>0){n=__SP_NOTIFY.shift();if(t.includeSticky===false&&n.options.sticky===true)i.push(n);else{SP.UI.Notify.removeNotification(n.id);setTimeout(function(){n.options.after.call(r,n.name,false)},150)}}__SP_NOTIFY=i.slice(0)}else if(e!==undefined){for(var s=0,o=__SP_NOTIFY.length;s<o;s++){if(__SP_NOTIFY[s].name==e){n=__SP_NOTIFY.splice(s,1)[0];SP.UI.Notify.removeNotification(n.id);setTimeout(function(){n.options.after.call(r,n.name,t.timeout)},150);return this}}}return this},registerPlugin:function(e,t){var n=$("html");var r=n.data("sp-plugins")||[];if(typeof r[e]!=="undefined")throw"Error 'registerPlugin': '"+e+"' is already registered.";r[e]=t;n.data("sp-plugins",r);return true},plugin:function(e,t){var n=$("html").data("sp-plugins")||[];t=t||{};if(typeof n[e]==="function")n[e].call(this,t);else throw"Error $SP().plugin: the plugin '"+e+"' is not registered.";return this}};var myElem=function(){var e=function(e){return new t(e)},t=function(e){this.mynode=e;this.singleList=true;return this};e.fn=t.prototype={getAttribute:function(e){return this.mynode.getAttribute("ows_"+e.replace(/ /g,""))},getAttributes:function(){return this.mynode.attributes}};return e}();var extendMyObject=function(e){this.attributes=e};extendMyObject.prototype.getAttribute=function(e){return this.attributes[e]};extendMyObject.prototype.getAttributes=function(){return this.attributes};SharepointPlus.prototype.noConflict=function(){window._$SP=window._SharepointPlus=window.$SP};return window.$SP=window.SharepointPlus=SharepointPlus})(window)
