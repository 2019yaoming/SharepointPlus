/*!
 * Created by Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/SharepointPlus/
 * Licence: CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
 */
if(!Array.indexOf){Array.prototype.indexOf=function(b){for(var a=this.length-1;a>-1;a--){if(this[a]==b){return a}}return -1}}_SP_APPROVED=0;_SP_REJECTED=1;_SP_PENDING=2;_SP_DRAFT=3;_SP_SCHEDULED=4;(function(e){var a=function(h,q){var l=h.length;var r=new Array(l);var j=l/8;var p=l%8;for(var m=l-1;m>-1;m--){var k=j;var o=p;do{switch(o){case 0:r[m]=q(h[m]);m--;case 7:r[m]=q(h[m]);m--;case 6:r[m]=q(h[m]);m--;case 5:r[m]=q(h[m]);m--;case 4:r[m]=q(h[m]);m--;case 3:r[m]=q(h[m]);m--;case 2:r[m]=q(h[m]);m--;case 1:r[m]=q(h[m]);m--}o=0}while(--k>0)}return r};var g=function(m,i,n,j,k,l,h){i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(k=l=h="";n=m.charAt(h++);~n&&(j=l%4?j*64+n:n,l++%4)?k+=String.fromCharCode(255&j>>(-2*l&6)):0){n=i.indexOf(n)}return k};var b=function(i,h,m,l,k,j){h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";m="=";for(l=j="";k&=3,i.charAt(l++)||(h="=",k);j+=h.charAt(63&m>>++k*2)){m=m<<8|i.charCodeAt(l-=!k)}return j};function f(){if(!(this instanceof arguments.callee)){return new arguments.callee()}}f.prototype={data:[],length:0,listQueue:[],needQueue:false,list:function(i,h){this.reset();if(h){this.url=h}else{this._getURL()}this.listID=i.replace(/&/g,"&amp;");return this},_getURL:function(){if(this.url===undefined&&typeof L_Menu_BaseUrl==="undefined"&&jQuery("body").data("sp-currenturl")===undefined){this.needQueue=true;var j=this;var h="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><WebUrlFromPageUrl xmlns='http://schemas.microsoft.com/sharepoint/soap/' ><pageUrl>"+e.location.href+"</pageUrl></WebUrlFromPageUrl></soap:Body></soap:Envelope>";var i=e.location.protocol+"//"+e.location.host+"/_vti_bin/Webs.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:i,data:h,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(l){var k=l.getElementsByTagName("WebUrlFromPageUrlResult");if(k.length){j.url=k[0].firstChild.nodeValue.toLowerCase();jQuery("body").data("sp-currenturl",j.url)}j.needQueue=false}})}else{this.url=this.url||jQuery("body").data("sp-currenturl")||(e.location.protocol+"//"+e.location.host+L_Menu_BaseUrl)}},_addInQueue:function(h){this.listQueue.push(h);if(this.listQueue.length===1){this._testQueue()}return this},_testQueue:function(){if(this.needQueue){var i=this;setTimeout(function(){i._testQueue.call(i)},25)}else{if(this.listQueue.length>0){var h=this.listQueue.shift();h.callee.apply(this,Array.prototype.slice.call(h))}this.needQueue=(this.listQueue.length>0);if(this.needQueue){var i=this;setTimeout(function(){i._testQueue.call(i)},25)}}},parse:function(t){var j=t.replace(/(\s+)?(=|<=|>=|<>|<|>| LIKE | like )(\s+)?/g,"$2").replace(/""|''/g,"Null").replace(/==/g,"=");var n=[];var h=t.length;var p="",o="",l=false;var s="";var w={open:0};for(var y=0;y<j.length;y++){var B=j.charAt(y);switch(B){case"(":var m=y;var u=false;while(j.charAt(y)=="("&&y<h){y++;w.open++}while(w.open>0&&y<h){y++;var r=j.charAt(y);if(r=="'"){u=!u}else{if(r==")"&&!u){w.open--}}}var z=n.length-1;if(z>=0){if(p!=""){n[0]="<"+p+">"+n[0]}n[0]+=this.parse(j.substring(m+1,y));if(p!=""){n[0]+="</"+p+">"}p=""}else{n[0]=this.parse(j.substring(m+1,y))}break;case">":case"<":y++;if(j.charAt(y)=="="){n.push("<"+(B==">"?"G":"L")+"eq>");o="</"+(B==">"?"G":"L")+"eq>"}else{if(B=="<"&&j.charAt(y)==">"){n.push("<Neq>");o="</Neq>"}else{y--;n.push("<"+(B==">"?"G":"L")+"t>");o="</"+(B==">"?"G":"L")+"t>"}}break;case"=":n.push("<Eq>");o="</Eq>";break;case" ":if(j.substring(y,y+5).toUpperCase()==" AND "){p="And";y+=4}else{if(j.substring(y,y+4).toUpperCase()==" OR "){p="Or";y+=3}else{if(j.slice(y,y+6).toUpperCase()==" LIKE "){y+=5;n.push("<Contains>");o="</Contains>"}else{s+=B}}}break;case'"':case"'":var x=B;var A="";while((B=j.charAt(++y))!=x&&y<h){if(B=="\\"){B=j.charAt(++y)}A+=B}z=n.length-1;n[z]+='<FieldRef Name="'+s+'" '+(A=="[Me]"?'LookupId="True" ':"")+"/>";s="";var k="Text";if(/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})?/.test(A)||A=="[Today]"){k="DateTime"}A=this._cleanString(A);switch(A){case"[Today]":A='<Today OffsetDays="0" />';break;case"[Me]":A='<UserID Type="Integer" />';k="Integer";break}n[z]+='<Value Type="'+k+'">'+A+"</Value>";n[z]+=o;o="";if(z>0){if(p!=""){n[0]="<"+p+">"+n[0]}n[0]+=n[z];if(p!=""){n[0]+="</"+p+">"}delete (n[z]);p=""}break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(o!=""){var v=B;while(!isNaN(B=j.charAt(++y))&&y<h){v+=""+B}z=n.length-1;n[z]+='<FieldRef Name="'+s+'" />';s="";n[z]+='<Value Type="Number">'+v.replace(/ $/,"")+"</Value>";n[z]+=o;o="";if(z>0){if(p!=""){n[0]="<"+p+">"+n[0]}n[0]+=n[z];if(p!=""){n[0]+="</"+p+">"}delete (n[z]);p=""}y-=2;break}default:if(o==""){s+=B}else{if(B.toLowerCase()=="n"&&j.substring(y,y+4).toLowerCase()=="null"){z=n.length-1;if(o=="</Neq>"){n[z]="<IsNotNull>";o="</IsNotNull>"}else{if(o=="</Eq>"){n[z]="<IsNull>";o="</IsNull>"}}y+=3;n[z]+='<FieldRef Name="'+s+'" />';s="";n[z]+=o;o="";if(z>0){if(p!=""){n[0]="<"+p+">"+n[0]}n[0]+=n[z];if(p!=""){n[0]+="</"+p+">"}delete (n[z]);p=""}}}}}return n.join("")},_parseOn:function(m){var h=[];var n=m.replace(/(\s+)?(=)(\s+)?/g,"$2").replace(/==/g,"=").split(" AND ");for(var k=0;k<n.length;k++){var l=n[k].match(/'([^']+)'\.([a-zA-Z0-9_]+)='([^']+)'\.([a-zA-Z0-9_]+)/);if(l&&l.length==5){var j={};j[l[1]]=l[2];j[l[3]]=l[4];h.push(j)}}return h},_cleanString:function(h){return h.replace(/&(?!amp;|lt;|gt;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},get:function(j,q){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'get': you have to define the list ID/Name"}if(arguments.length===1&&typeof j==="function"){return this.get({},j)}j=j||{};if(this.url==undefined){throw"Error 'get': not able to find the URL!"}j.fields=j.fields||"";j.where=j.where||"";j.orderby=j.orderby||"";j.groupby=j.groupby||"";j.rowlimit=j.rowlimit||0;j.expandUserField=(j.expandUserField===true?"True":"False");j.view=j.view||"";if(j.view!==""){if(j.view.charAt(0)!=="{"){var o=this;o.view(j.view,function(x,y){j.view=y;var i=(j.whereCAML?j.where:o.parse(j.where));i+=x.whereCAML;if(j.where!==""&&x.whereCAML!==""){i="<And>"+i+"</And>"}j.where=i;j.fields+=(j.fields===""?"":",")+x.fields.join(",");j.orderby+=(j.orderby===""?"":",")+x.orderby;j.whereCAML=true;j.useOWS=true;delete j.view;return o.get.call(o,j,q)});return this}if(j.whereCAML!==true){j.where=this.parse(j.where);j.whereCAML=true}}var w=true;var n="";if(j.fields==""||j.fields==[]){n="<AllFields />"}else{if(typeof j.fields=="string"){j.fields=j.fields.replace(/^\s+/,"").replace(/\s+$/,"").replace(/( )?,( )?/g,",").split(",")}for(var k=0;k<j.fields.length;k++){n+='<FieldRef Name="'+j.fields[k]+'" />'}}var p="";if(j.orderby!=""){var v=j.orderby.split(",");for(k=0;k<v.length;k++){var u="ASC";var r=jQuery.trim(v[k]).split(" ");if(r.length>0){if(r.length==2){u=r[1].toUpperCase()}p+=(w?'<FieldRef Name="'+r[0]+'" Ascending="'+(u=="ASC")+'" />':'<OrderField Name="'+r[0]+'" Direction="'+u+'" />')}}}var t="";if(j.groupby!=""){var m=j.groupby.split(",");for(k=0;k<m.length;k++){t+='<FieldRef Name="'+m[k]+'" />'}}var l="";var s=[];var o=this;if(w){l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><viewName>"+j.view+"</viewName><query><Query>"+(j.where!=""?"<Where>"+(j.whereCAML?j.where:this.parse(j.where))+"</Where>":"")+(t!=""?"<GroupBy>"+t+"</GroupBy>":"")+(p!=""?"<OrderBy>"+p+"</OrderBy>":"")+"</Query></query><viewFields><ViewFields Properties='True'> "+n+"</ViewFields></viewFields><rowLimit>"+j.rowlimit+'</rowLimit><queryOptions><QueryOptions><ViewAttributes Scope="Recursive"></ViewAttributes><IncludeAttachmentUrls>True</IncludeAttachmentUrls><IncludeMandatoryColumns>False</IncludeMandatoryColumns><ExpandUserField>'+j.expandUserField+"</ExpandUserField></QueryOptions></queryOptions></GetListItems></soap:Body></soap:Envelope>";var h=this.url+"/_vti_bin/Lists.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:h,data:l,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(R){var E=R.getElementsByTagName("z:row");if(E.length==0){E=R.getElementsByTagName("row")}s=a(E,function(i){return d(i)});if(j.joinData){var F=j.joinData.noindex;var x=[];var C="";var Q={length:0};if(!F.length){throw"Error 'get': you must define the ON clause with JOIN is used."}for(var O=0,K=s.length;O<K;O++){var B="";for(var M=0;M<F.length;M++){B+=s[O].getAttribute(F[M][o.listID])}if(j.joinData[B]){if(C!==B){Q[j.joinIndex[B]]=true;Q.length++;C=B}for(var M=0,A=j.joinData[B].length;M<A;M++){var P=[];var y=s[O].getAttributes();for(var I=y.length;I--;){P[o.listID+"."+y[I].nodeName.slice(4)]=y[I].nodeValue}var G=j.joinData[B][M].getAttributes();for(var I in G){P[I]=j.joinData[B][M].getAttribute(I)}x.push(new c(P))}}if(j.innerjoin){j.join=j.innerjoin}if(j.outerjoin){j.join=j.outerjoin;j.join.outer=true}}s=x;if(j.outer){var L=j.joinIndex.length;if(Q.length<L){for(O=0;O<L;O++){if(Q[O]!==true){var H=j.joinIndex[O];for(var M=0,A=j.joinData[H].length;M<A;M++){var P=[];var G=j.joinData[H][M].getAttributes();for(var I in G){P[I]=j.joinData[H][M].getAttribute(I)}x.push(new c(P))}}}}}}if(j.outerjoin){j.join=j.outerjoin;j.join.outer=true}else{if(j.innerjoin){j.join=j.innerjoin}}if(j.join){var J=[],z=[];var F=o._parseOn(j.join.on);J.noindex=F;for(var O=0,K=s.length;O<K;O++){var B="",P=[];for(var M=0;M<F.length;M++){B+=s[O].getAttribute(F[M][o.listID])||s[O].getAttribute(o.listID+"."+F[M][o.listID])}if(!J[B]){z[B]=z.length;z.push(B);J[B]=[]}if(j.joinData){J[B].push(s[O])}else{var D=s[O].getAttributes();for(var M=D.length;M--;){P[o.listID+"."+D[M].nodeName.slice(4)]=D[M].nodeValue}J[B].push(new c(P))}}delete j.joinData;var N=$SP().list(j.join.list,j.join.url||o.url);j.join.joinData=J;j.join.joinIndex=z;N.get(j.join,q)}else{if(typeof q=="function"){q.call(o,s)}}}})}return this},createFile:function(h){h=h||{};if(h.content==undefined){throw"Error 'createFile': not able to find the file content."}if(h.destination==undefined){throw"Error 'createFile': not able to find the file destination path."}if(h.url==undefined){throw"Error 'createFile': not able to find the URL!"}h.after=h.after||(function(){});var j=this;var i='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><CopyIntoItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><SourceUrl>http://null</SourceUrl><DestinationUrls><string>'+h.destination+"</string></DestinationUrls><Fields><FieldInformation Type='File' /></Fields><Stream>"+b(h.content)+"</Stream></CopyIntoItems></soap:Body></soap:Envelope>";jQuery.ajax({url:h.url+"/_vti_bin/copy.asmx",type:"POST",dataType:"xml",data:i,beforeSend:function(k){k.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CopyIntoItems")},contentType:'text/xml; charset="utf-8"',success:function(l){var k=l.getElementsByTagName("CopyResult");if(k&&k[0]&&k[0].getAttribute("ErrorCode")!="Success"){throw"Error 'createFile': "+k[0].getAttribute("ErrorCode")+" - "+k[0].getAttribute("ErrorMessage")}if(typeof h.after=="function"){h.after.call(j)}}})},getAttachment:function(l,k){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'getAttachment': you have to define the list ID/Name"}if(arguments.length===1&&typeof l==="function"){throw"Error 'getAttachment': you have to define the item ID"}setup=setup||{};if(this.url==undefined){throw"Error 'getAttachment': not able to find the URL!"}var h='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"> <soap:Body> <GetAttachmentCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/"> <listName>'+this.listID+"</listName> <listItemID>"+l+"</listItemID> </GetAttachmentCollection> </soap:Body></soap:Envelope>";var m=this;var j=this.url+"/_vti_bin/lists.asmx";var i=[];jQuery.ajax({type:"POST",cache:false,async:true,url:j,data:h,contentType:"text/xml; charset=utf-8",beforeSend:function(n){n.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetAttachmentCollection")},dataType:"xml",success:function(p){var n=p.getElementsByTagName("Attachment");for(var o=0;o<n.length;o++){i.push(n[o].firstChild.nodeValue)}if(typeof k==="function"){k.call(m,i)}}});return this},info:function(k){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'info': you have to define the list ID"}if(this.url==undefined){throw"Error 'info': not able to find the URL!"}var h='<?xml version="1.0" encoding="utf-8"?>';h+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';h+="  <soap:Body>";h+='    <GetList xmlns="http://schemas.microsoft.com/sharepoint/soap/">';h+="      <listName>"+this.listID+"</listName>";h+="    </GetList>";h+="  </soap:Body>";h+="</soap:Envelope>";var l=this;var j=this.url+"/_vti_bin/lists.asmx";var i=[];jQuery.ajax({type:"POST",cache:false,async:true,url:j,data:h,contentType:"text/xml; charset=utf-8",beforeSend:function(m){m.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetList")},dataType:"xml",success:function(u){var m=u.getElementsByTagName("Field");var q=0,p;for(var s=0;s<m.length;s++){if(m[s].getAttribute("ID")){i[q]=[];p=i[q];p.Description=m[s].getAttribute("Description");p.StaticName=m[s].getAttribute("StaticName");p.DisplayName=m[s].getAttribute("DisplayName");p.Format=m[s].getAttribute("Format");p.SourceID=m[s].getAttribute("SourceID");p.Required=m[s].getAttribute("Required");p.Type=m[s].getAttribute("Type");if(p.Type=="Choice"||p.Type=="MultiChoice"){p.FillInChoice=m[s].getAttribute("FillInChoice");var n=m[s].getElementsByTagName("CHOICE");var t=[];for(var o=0;o<n.length;o++){t.push(n[o].firstChild.nodeValue)}p.Choices=t}else{if(p.Type==="Lookup"){p.Choices={list:m[s].getAttribute("List"),field:m[s].getAttribute("ShowField")}}else{p.Choices=[]}}p.DefaultValue=(m[s].getElementsByTagName("Default").length>0?m[s].getElementsByTagName("Default")[0].nodeValue:"");q++}}if(typeof k=="function"){k.call(l,i)}}});return this},view:function(j,n){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'view': you have to define the list ID/Name"}if(arguments.length===1&&typeof j==="function"){return this.view("",j)}list=this.listID;if(this.url==undefined){throw"Error 'view': not able to find the URL!"}j=j||"";var p=arguments[2]||j;p=p.toLowerCase();var q=jQuery("body").data("sp-view");if(q!=undefined){for(var k=q.length;k--;){if(q[k].url===this.url&&(q[k].viewID===j||q[k].viewName===p)){n.call(this,q[k].data,j);return this}}}else{q=[]}if(j.charAt(0)!=="{"){this.views(function(r){var t=false;for(var s=r.length;s--;){if(r[s]["Name"]===j){this.view(r[s]["ID"],n,j);t=true;break}}if(!t){throw"Error 'view': not able to find the view called '"+j+"' at "+this.url}});return this}var l='<?xml version="1.0" encoding="utf-8"?>';l+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';l+="  <soap:Body>";l+='    <GetView xmlns="http://schemas.microsoft.com/sharepoint/soap/">';l+="      <listName>"+this.listID+"</listName>";l+="      <viewName>"+j+"</viewName>";l+="    </GetView>";l+="  </soap:Body>";l+="</soap:Envelope>";var h=this.url+"/_vti_bin/Views.asmx";var o=["fields","orderby","whereCAML"];var m=this;jQuery.ajax({type:"POST",cache:false,async:true,url:h,data:l,contentType:"text/xml; charset=utf-8",beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetView")},dataType:"xml",success:function(v){o.fields=[];var r=v.getElementsByTagName("ViewFields")[0].getElementsByTagName("FieldRef");for(var t=0;t<r.length;t++){o.fields.push(r[t].getAttribute("Name"))}o.orderby="";r=v.getElementsByTagName("OrderBy");if(r.length){var u=[];r=r[0].getElementsByTagName("FieldRef");for(var t=0;t<r.length;t++){u.push(r[t].getAttribute("Name")+" "+(r[t].getAttribute("Ascending")==undefined?"ASC":"DESC"))}o.orderby=u.join(",")}o.whereCAML="";var s=v.getElementsByTagName("Where");if(s.length){s=s[0].xml||(new XMLSerializer()).serializeToString(s[0]);s=s.match(/<Where [^>]+>(.*)<\/Where>/);if(s.length==2){o.whereCAML=s[1]}}q.push({url:m.url,data:o,viewID:j,viewName:p});jQuery("body").data("sp-view",q);if(typeof n=="function"){n.call(m,o,j)}}});return this},views:function(m){if(this.needQueue){return this._addInQueue(arguments)}if(this.listID==undefined){throw"Error 'views': you have to define the list ID"}if(this.url==undefined){throw"Error 'views': not able to find the URL!"}m=m||function(){};var j=jQuery("body").data("sp-views");if(j!=undefined){for(var n=j.length;n--;){if(j[n].url==this.url){m.call(this,j[n].data);return this}}}else{j=[]}var h='<?xml version="1.0" encoding="utf-8"?>';h+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';h+="  <soap:Body>";h+='    <GetViewCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">';h+="      <listName>"+this.listID+"</listName>";h+="    </GetViewCollection>";h+="  </soap:Body>";h+="</soap:Envelope>";var l=this.url+"/_vti_bin/Views.asmx";var k=[];var o=this;jQuery.ajax({type:"POST",cache:false,async:true,url:l,data:h,contentType:"text/xml; charset=utf-8",beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection")},dataType:"xml",success:function(r){var p=r.getElementsByTagName("View");for(var q=0;q<p.length;q++){k[q]=[];k[q]["ID"]=p[q].getAttribute("Name");k[q]["Name"]=p[q].getAttribute("DisplayName");k[q]["Url"]=p[q].getAttribute("Url")}j.push({url:o.url,data:k});jQuery("body").data("sp-views",j);m.call(o,k)}});return this},lists:function(k,n){if(arguments.length===1&&typeof k==="function"){return this.lists({},k)}k=k||{};k.url=k.url||this.url;if(!k.url){this._getURL();return this._addInQueue(arguments)}if(this.url==undefined){throw"Error 'lists': not able to find the URL!"}var j='<?xml version="1.0" encoding="utf-8"?>';j+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';j+="  <soap:Body>";j+='    <GetListCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">';j+="    </GetListCollection>";j+="  </soap:Body>";j+="</soap:Envelope>";var h=jQuery("body").data("sp-lists");if(h!=undefined){for(var o=h.length;o--;){if(h[o].url==this.url){if(typeof n=="function"){n(h[o].data)}else{this.data=h[o].data;this.length=this.data.length}return this}}}else{h=[]}var m=this.url+"/_vti_bin/lists.asmx";var l=[];var p=this;jQuery.ajax({type:"POST",cache:false,async:true,url:m,data:j,contentType:"text/xml; charset=utf-8",beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListCollection")},dataType:"xml",success:function(s){var q=s.getElementsByTagName("List");for(var r=0;r<q.length;r++){l[r]=[];l[r]["ID"]=q[r].getAttribute("ID");l[r]["Name"]=q[r].getAttribute("Title");l[r]["Url"]=q[r].getAttribute("DefaultViewUrl");l[r]["Description"]=q[r].getAttribute("Description")}h.push({url:p.url,data:l});jQuery("body").data("sp-lists",h);if(typeof n=="function"){n.call(p,l)}}});return this},each:function(h,i){switch(arguments.length){case 0:throw"Error 'each': you have to provide a function.";break;case 1:if(typeof h=="function"){jQuery.each(this.data,h)}else{throw"Error 'each': you have to provide a function."}break;default:if(jQuery.type(h)==="array"&&jQuery.type(i)==="function"){jQuery.each(h,i)}break}},add:function(n,j){if(this.needQueue){return this._addInQueue(arguments)}if(arguments.length===0||(arguments.length===1&&typeof n==="object"&&n.length===undefined)){throw"Error 'add': you need to define the list of items"}if(this.listID===undefined){throw"Error 'add': you need to use list() to define the list name."}j=j||{};if(this.url==undefined){throw"Error 'add': not able to find the URL!"}j.success=j.success||(function(){});j.error=j.error||(function(){});j.after=j.after||(function(){});j.escapeChar=(j.escapeChar==undefined)?true:j.escapeChar;j.progress=j.progress||(function(){});if(typeof n==="object"&&n.length==undefined){n=[n]}var r=n.length;j.progressVar=j.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spAdd"+(""+Math.random()).slice(2)};if(r>15){var o=n.slice(0);var p=o.splice(0,15);var m=this;jQuery(document).on(j.progressVar.eventID,function(i){jQuery(document).off(j.progressVar.eventID);m.add(o,i.setup)});this.add(p,j);return this}else{if(r==0){throw"'add': nothing to add!"}}j.progressVar.current+=r;var q='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var m=this;for(var k=0;k<n.length;k++){q+='<Method ID="'+(k+1)+'" Cmd="New">';q+="<Field Name='ID'>New</Field>";jQuery.each(n[k],function(i,s){if(typeof s==="object"&&s.items!=undefined){s=";#"+s.join(";#")+";#"}if(j.escapeChar&&typeof s==="string"){s=m._cleanString(s)}q+="<Field Name='"+i+"'>"+s+"</Field>"});q+="</Method>"}q+="</Batch>";var l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+q+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var h=this.url+"/_vti_bin/lists.asmx";var m=this;jQuery.ajax({type:"POST",cache:false,async:true,url:h,data:l,beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(x){var t=x.getElementsByTagName("Result");var s=t.length;var y=j.progressVar.passed,u=j.progressVar.failed;for(var v=0;v<s;v++){if(t[v].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){var w=t[v].getElementsByTagName("z:row");if(w.length==0){w=t[v].getElementsByTagName("row")}n[v].ID=w[0].getAttribute("ows_ID");y.push(n[v])}else{n[v].errorMessage=t[v].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;u.push(n[v])}}j.progress(j.progressVar.current,j.progressVar.max);if(j.progressVar.current<j.progressVar.max){jQuery(document).trigger({type:j.progressVar.eventID,setup:j})}else{if(y.length>0){j.success.call(m,y)}if(u.length>0){j.error.call(m,u)}j.after.call(m)}}});return this},update:function(n,j){if(this.needQueue){return this._addInQueue(arguments)}if(arguments.length===0||(arguments.length===1&&typeof n==="object"&&n.length===undefined)){throw"Error 'update': you need to define the list of items"}if(this.listID===undefined){throw"Error 'update': you need to use list() to define the list name."}j=j||{};if(this.url==undefined){throw"Error 'update': not able to find the URL!"}j.where=j.where||"";j.success=j.success||(function(){});j.error=j.error||(function(){});j.after=j.after||(function(){});j.escapeChar=(j.escapeChar==undefined)?true:j.escapeChar;j.progress=j.progress||(function(){});if(typeof n==="object"&&n.length==undefined){n=[n]}var r=n.length;if(r==1&&j.where){delete n[0].ID;var m=this;this.get({fields:"ID",where:j.where},function(v){var w=function(y){var x={};for(var i in y){x[i]=y[i]}return x};var s=[];for(var t=v.length;t--;){var u=w(n[0]);u.ID=v[t].getAttribute("ID");s.push(u)}delete j.where;m.update(s,j)});return this}j.progressVar=j.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spUpdate"+(""+Math.random()).slice(2)};if(r>15){var o=n.slice(0);var p=o.splice(0,15);var m=this;jQuery(document).on(j.progressVar.eventID,function(i){jQuery(document).off(j.progressVar.eventID);m.update(o,i.setup)});this.update(p,j);return this}else{if(r==0){throw"'update': nothing to update!"}}j.progressVar.current+=r;var q='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var m=this;for(var k=0;k<r;k++){q+='<Method ID="'+(k+1)+'" Cmd="Update">';if(n[k].ID==undefined){throw"Error 'update': you have to provide the item ID called 'ID'"}jQuery.each(n[k],function(i,s){if(typeof s==="object"&&s.length!=undefined){s=";#"+s.join(";#")+";#"}if(j.escapeChar&&typeof s==="string"){s=m._cleanString(s)}q+="<Field Name='"+i+"'>"+s+"</Field>"});q+="</Method>"}q+="</Batch>";var l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+q+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var h=this.url+"/_vti_bin/lists.asmx";var m=this;jQuery.ajax({type:"POST",cache:false,async:true,url:h,data:l,beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(w){var t=w.getElementsByTagName("Result");var s=t.length;var x=j.progressVar.passed,u=j.progressVar.failed;for(var v=0;v<s;v++){if(t[v].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){x.push(n[v])}else{n[v].errorMessage=t[v].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;u.push(n[v])}}j.progress(j.progressVar.current,j.progressVar.max);if(j.progressVar.current<j.progressVar.max){jQuery(document).trigger({type:j.progressVar.eventID,setup:j})}else{if(x.length>0){j.success.call(m,x)}if(u.length>0){j.error.call(m,u)}j.after.call(m)}}});return this},moderate:function(n,j){if(this.needQueue){return this._addInQueue(arguments)}if(arguments.length===0||(arguments.length===1&&typeof n==="object"&&n.length===undefined)){throw"Error 'moderate': you need to define the list of items"}if(this.listID===undefined){throw"Error 'moderate': you need to use list() to define the list name."}j=j||{};if(this.url==undefined){throw"Error 'moderate': not able to find the URL!"}j.async=(j.async==undefined)?true:j.async;j.success=j.success||(function(){});j.error=j.error||(function(){});j.after=j.after||(function(){});if(typeof n==="object"&&n.length==undefined){n=[n]}while(n.length>15){var o=n.slice(0,15);n.splice(0,15);this.moderate(list,o,j)}var q='<Batch OnError="Continue" ListVersion="1"  ViewName="">';var p=this;for(var k=0;k<n.length;k++){q+='<Method ID="'+(k+1)+'" Cmd="Moderate">';if(n[k].ID==undefined){throw"Error 'moderate': you have to provide the item ID called 'ID'"}else{if(n[k].ApprovalStatus==undefined){throw"Error 'moderate': you have to provide the approval status 'ApprovalStatus' (Approved, Rejected, Pending, Draft or Scheduled)"}}jQuery.each(n[k],function(i,r){if(i=="ApprovalStatus"){i="_ModerationStatus";switch(r.toLowerCase()){case"approve":case"approved":r=0;break;case"reject":case"deny":case"denied":case"rejected":r=1;break;case"pending":r=2;break;case"draft":r=3;break;case"scheduled":r=4;break;default:r=2;break}}q+="<Field Name='"+i+"'>"+r+"</Field>"});q+="</Method>"}q+="</Batch>";var l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+q+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var h=this.url+"/_vti_bin/lists.asmx";var m=this;jQuery.ajax({type:"POST",cache:false,async:true,url:h,data:l,beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(w){var s=w.getElementsByTagName("Result");var r=s.length;var x=[],t=[];for(var u=0;u<r;u++){var v=d(s[u].getElementsByTagName("z:row")[0]);if(s[u].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){x.push(v)}else{n[u].errorMessage=s[u].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;t.push(n[u])}}if(x.length>0){j.success.call(m,x)}if(t.length>0){j.error.call(m,t)}j.after.call(m)}});return this},remove:function(n,j){if(this.needQueue){return this._addInQueue(arguments)}if(!j&&n.where){j=n;n=[]}j=j||{};if(this.url==undefined){throw"Error 'remove': not able to find the URL!"}j.success=j.success||(function(){});j.error=j.error||(function(){});j.after=j.after||(function(){});j.progress=j.progress||(function(){});if(typeof n==="object"&&n.length==undefined){n=[n]}var r=n.length;if(j.where){if(r==1){delete n[0].ID}var m=this;this.get({fields:"ID",where:j.where},function(v){var w=function(y){var x={};for(var i in y){x[i]=y[i]}return x};var s=[];for(var t=v.length;t--;){var u=w(n[0]);u.ID=v[t].getAttribute("ID");s.push(u)}delete j.where;m.remove(s,j)});return this}else{if(r==0){throw"'remove': nothing to delete!"}}j.progressVar=j.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spRemove"+(""+Math.random()).slice(2)};if(r>15){var o=n.slice(0);var p=o.splice(0,15);var m=this;jQuery(document).on(j.progressVar.eventID,function(i){jQuery(document).off(j.progressVar.eventID);m.remove(o,i.setup)});this.remove(p,j);return this}j.progressVar.current+=r;var q='<Batch OnError="Continue" ListVersion="1"  ViewName="">';for(var k=0;k<n.length;k++){q+='<Method ID="'+(k+1)+'" Cmd="Delete">';if(n[k].ID==undefined){throw"Error 'delete': you have to provide the item ID called 'ID'"}q+="<Field Name='ID'>"+n[k].ID+"</Field>";q+="</Method>"}q+="</Batch>";var l='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+this.listID+"</listName><updates>"+q+"</updates></UpdateListItems></soap:Body></soap:Envelope>";var m=this;var h=this.url+"/_vti_bin/lists.asmx";jQuery.ajax({type:"POST",cache:false,async:true,url:h,data:l,beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(w){var t=w.getElementsByTagName("Result");var s=t.length;var x=j.progressVar.passed,u=j.progressVar.failed;for(var v=0;v<s;v++){if(t[v].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue=="0x00000000"){x.push(n[v])}else{n[v].errorMessage=t[v].getElementsByTagName("ErrorText")[0].firstChild.nodeValue;u.push(n[v])}}j.progress(j.progressVar.current,j.progressVar.max);if(j.progressVar.current<j.progressVar.max){jQuery(document).trigger({type:j.progressVar.eventID,setup:j})}else{if(x.length>0){j.success.call(m,x)}if(u.length>0){j.error.call(m,u)}j.after.call(m)}}});return this},usergroups:function(p,j,m){switch(arguments.length){case 1:if(typeof p==="object"){return this.usergroups("",p,function(){})}else{if(typeof p==="function"){return this.usergroups("",{},p)}}break;case 2:if(typeof p==="string"&&typeof j==="function"){return this.usergroups(p,{},j)}if(typeof p==="object"&&typeof j==="function"){return this.usergroups("",p,j)}}j=j||{};if(j.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{j.url=this.url}}else{this.url=j.url}m=m||(function(){});if(!p){throw"Error 'usergroups': you have to set an username."}p=p.toLowerCase();j.url=j.url.toLowerCase();var k=jQuery("body").data("sp-usergroups")||[];for(var n=k.length;n--;){if(k[n].user.toLowerCase()==p&&k[n].url.toLowerCase()==j.url){m.call(this,k[n].data);return this}}var h="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetGroupCollectionFromUser xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'><userLoginName>"+p+"</userLoginName></GetGroupCollectionFromUser></soap:Body></soap:Envelope>";var o=this;var l=j.url+"/_vti_bin/usergroup.asmx";jQuery.ajax({type:"POST",cache:false,url:l,data:h,beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetGroupCollectionFromUser")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(s){var t=[];s=s.getElementsByTagName("Group");for(var r=0,q=s.length;r<q;r++){t.push(s[r].getAttribute("Name"))}k.push({user:p,url:j.url,data:t});jQuery("body").data("sp-usergroups",k);m.call(o,t)},error:function(q,s,r){if(j.error===false){m.call(o,[])}else{var i=q.responseXML.getElementsByTagName("errorstring");if(console){console.error("Error 'usergroups': "+i[0].firstChild.nodeValue)}}}});return this},distributionLists:function(p,j,m){switch(arguments.length){case 1:if(typeof p==="object"){return this.distributionLists("",p,function(){})}else{if(typeof p==="function"){return this.distributionLists("",{},p)}}break;case 2:if(typeof p==="string"&&typeof j==="function"){return this.distributionLists(p,{},j)}if(typeof p==="object"&&typeof j==="function"){return this.distributionLists("",p,j)}}j=j||{};if(j.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{j.url=this.url}}else{this.url=j.url}m=m||(function(){});if(!p){throw"Error 'distributionLists': you have to set an username."}p=p.toLowerCase();j.url=j.url.toLowerCase();var k=jQuery("body").data("sp-distributionLists")||[];for(var n=k.length;n--;){if(k[n].user===p&&k[n].url===j.url){m.call(this,k[n].data);return this}}var h="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetCommonMemberships xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'><accountName>"+p+"</accountName></GetCommonMemberships></soap:Body></soap:Envelope>";var o=this;var l=j.url+"/_vti_bin/UserProfileService.asmx";jQuery.ajax({type:"POST",cache:false,url:l,data:h,beforeSend:function(i){i.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserMemberships")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(s){var t=[];s=s.getElementsByTagName("MembershipData");for(var r=0,q=s.length;r<q;r++){if(s[r].getElementsByTagName("Source")[0].firstChild.nodeValue==="DistributionList"){t.push({SourceReference:s[r].getElementsByTagName("SourceReference")[0].firstChild.nodeValue,DisplayName:s[r].getElementsByTagName("DisplayName")[0].firstChild.nodeValue,MailNickname:s[r].getElementsByTagName("MailNickname")[0].firstChild.nodeValue,Url:s[r].getElementsByTagName("Url")[0].firstChild.nodeValue})}}k.push({user:p,url:j.url,data:t});jQuery("body").data("sp-distributionLists",k);m.call(o,t)},error:function(q,s,r){var i=q.responseXML.getElementsByTagName("errorstring");if(console){console.error("Error 'distributionLists': "+i[0].firstChild.nodeValue)}}});return this},groupMembers:function(l,j,n){switch(arguments.length){case 1:if(typeof l==="object"){return this.groupMembers("",l,function(){})}else{if(typeof l==="function"){return this.groupMembers("",{},l)}}break;case 2:if(typeof l==="string"&&typeof j==="function"){return this.groupMembers(l,{},j)}if(typeof l==="object"&&typeof j==="function"){return this.groupMembers("",l,j)}}j=j||{};if(j.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{j.url=this.url}}else{this.url=j.url}n=n||(function(){});if(!l){throw"Error 'groupMembers': you have to set an groupname."}l=l.toLowerCase();j.url=j.url.toLowerCase();var k=jQuery("body").data("sp-groupMembers")||[];for(var o=k.length;o--;){if(k[o].group===l&&k[o].url===j.url){n.call(this,k[o].data);return this}}var h="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetUserCollectionFromGroup xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/'><groupName>"+this._cleanString(l)+"</groupName></GetUserCollectionFromGroup></soap:Body></soap:Envelope>";var p=this;var m=j.url+"/_vti_bin/usergroup.asmx";jQuery.ajax({type:"POST",cache:false,url:m,data:h,beforeSend:function(i){i.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetUserCollectionFromGroup")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(s){var t=[];s=s.getElementsByTagName("User");for(var r=0,q=s.length;r<q;r++){t.push({ID:s[r].getAttribute("ID"),Name:s[r].getAttribute("Name"),LoginName:s[r].getAttribute("LoginName"),Email:s[r].getAttribute("Email")})}k.push({group:l,url:j.url,data:t});jQuery("body").data("sp-groupMembers",k);n.call(p,t)},error:function(q,s,r){if(j.error===false){n.call(p,[])}else{var i=q.responseXML.getElementsByTagName("errorstring");if(console){console.error("Error 'groupMembers': "+i[0].firstChild.nodeValue)}}}});return this},isMember:function(h,i){h=h||{};if(h.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{h.url=this.url}}else{this.url=h.url}i=i||(function(){});if(!h.user){throw"Error 'isMember': you have to set an user."}if(!h.group){throw"Error 'isMember': you have to set a group."}h.group=h.group.toLowerCase();this.usergroups(h.user,{error:false},function(j){for(var k=j.length;k--;){if(j[k].toLowerCase()===h.group){i.call(this,true);return this}}this.groupMembers(h.group,{error:false},function(l){var n=[];for(var o=l.length;o--;){n.push(l[o].Name.toLowerCase())}this.distributionLists(h.user,function(m){for(var p=m.length;p--;){if(n.indexOf(m[p].DisplayName.toLowerCase())>-1){i.call(this,true);return this}}i.call(this,false);return this})})});return this},people:function(m,i,k){switch(arguments.length){case 1:if(typeof m==="object"){return this.people("",m,function(){})}else{if(typeof m==="function"){return this.people("",{},m)}}m=undefined;break;case 2:if(typeof m==="string"&&typeof i==="function"){return this.people(m,{},i)}if(typeof m==="object"&&typeof i==="function"){return this.people("",m,i)}}i=i||{};if(i.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{i.url=this.url}}else{this.url=i.url}k=k||(function(){});m=m||"";var h="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetUserProfileByName xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService'><AccountName>"+m+"</AccountName></GetUserProfileByName></soap:Body></soap:Envelope>";var l=this;var j=i.url+"/_vti_bin/UserProfileService.asmx";jQuery.ajax({type:"POST",cache:false,url:j,data:h,beforeSend:function(n){n.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserProfileByName")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){var s=[];r=r.getElementsByTagName("PropertyData");for(var p=0,n=r.length;p<n;p++){var o=r[p].getElementsByTagName("Name")[0].firstChild.nodeValue;var q=r[p].getElementsByTagName("Value");if(q&&q.length>=1){q=q[0].firstChild.nodeValue}else{q="No Value"}s.push(o);s[o]=q}k.call(l,s)},error:function(o,q,p){var n=o.responseXML.getElementsByTagName("errorstring");if(console){console.error("Error 'people': "+n[0].firstChild.nodeValue)}}});return this},addressbook:function(m,i,k){switch(arguments.length){case 1:if(typeof m==="object"){return this.addressbook("",m,function(){})}else{if(typeof m==="function"){return this.addressbook("",{},m)}}m=undefined;break;case 2:if(typeof m==="string"&&typeof i==="function"){return this.addressbook(m,{},i)}if(typeof m==="object"&&typeof i==="function"){return this.addressbook("",m,i)}}i=i||{};if(i.url==undefined){if(!this.url){this._getURL();return this._addInQueue(arguments)}else{i.url=this.url}}else{this.url=i.url}i.limit=i.limit||10;i.type=i.type||"User";k=k||(function(){});m=m||"";var h="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><SearchPrincipals xmlns='http://schemas.microsoft.com/sharepoint/soap/'><searchText>"+m+"</searchText><maxResults>"+i.limit+"</maxResults><principalType>"+i.type+"</principalType></SearchPrincipals></soap:Body></soap:Envelope>";var l=this;var j=i.url+"/_vti_bin/People.asmx";jQuery.ajax({type:"POST",cache:false,url:j,data:h,beforeSend:function(n){n.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(q){var u=[];q=q.getElementsByTagName("PrincipalInfo");for(var r=0,v=q.length;r<v;r++){var o=q[r].childNodes;u[r]=[];for(var p=0,s=o.length;p<s;p++){var n=o[p].nodeName;var t=o[p].firstChild;if(t){t=t.nodeValue}u[r].push(n);u[r][n]=t}}k.call(l,u)}});return this},reset:function(){this.data=[];this.length=0;this.listID="";this.needQueue=false;this.listQueue=[];delete this.url},toDate:function(m){if(m.length!=19){return new Date()}var l=m.substring(0,4);var n=m.substring(5,7);var i=m.substring(8,10);var h=m.substring(11,13);var j=m.substring(14,16);var k=m.substring(17,19);return new Date(l,n-1,i,h,j,k)},toSPDate:function(l){var n=function(p){if(p.toString().length==1){p="0"+p}return p};var m=n(l.getMonth()+1);var i=n(l.getDate());var k=l.getFullYear();var h=n(l.getHours());var j=n(l.getMinutes());var o=n(l.getSeconds());return k+"-"+m+"-"+i+" "+h+":"+j+":"+o},toCurrency:function(k,p,l){k=Number(k);if(p===undefined){p=-1}if(l===undefined){l="$"}var o="";if(k<0){o="-";k*=-1}var u=k;if(p===-1){u=u.toFixed(2).replace(".00","")}else{u=u.toFixed(p)}var h=(Math.floor(k)+"").length;for(var r=0,q=0,t=h%3;r<h;r++){if(r==0||r%3!=t){continue}u=u.substr(0,r+q)+","+u.substr(r+q);q++}return(l!=""?l:"")+o+u+(l!=""?"":" "+l)},getLookup:function(i){var h=i.split(";#");return{id:h[0],value:h[1]}},toXSLString:function(m){if(typeof m!=="string"){throw"Error 'toXLSString': '"+m+"' is not a string...."}var l=function(o,u){u=u||false;var p=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");var y="";for(var r=0;r<o.length;r++){var v=o.charAt(r);var s=v.charCodeAt(0);var x=0;var w="";while(s>=16){x=s%16;s=Math.floor(s/16);w+=p[x]}w+=p[s];var t="";for(var q=w.length-1;q>=0;q--){t+=w.charAt(q)}y+="%"+t}return y};var h=m.split(" ");var j="";if(/[0-9]/.test(h[0])&&h[0].length<5){j=l(m.charAt(0));m=m.substring(1)}for(var k=0;k<m.length;k++){var n=m.charAt(k);if(/[0-9A-Za-z_]/.test(n)===false){j+=l(n).toLowerCase()}else{j+=n}}return j.replace(/%([a-zA-Z0-9][a-zA-Z0-9])/g,"_x00$1_").substring(0,32)},formfields:function(y,G){this.reset();if(arguments.length==1&&jQuery.type(y)==="object"){G=y;y=undefined}G=G||[];y=y||"";var o=[];if(jQuery.type(y)=="string"){y=(y===""?[]:y.split(","))}var l=function(J){if(J==undefined){var k=[];var I=(jQuery.type(s.values)=="array"?this.values:[this.values]);for(var t=0;t<I.length;t++){if(I[t]!==""){k.push(I[t])}}if(k.length==1){return k[0]}else{if(k.length==0){return""}else{return k}}}else{if(jQuery.type(J)=="string"||jQuery.type(J)=="boolean"){J=[J]}}if(jQuery.type(J)=="array"){for(t=0;t<this.elements.length;t++){if(this.elements[t].tagName.toLowerCase()=="option"){if(J.indexOf(jQuery(this.elements[t]).val())!=-1){this.elements[t].selected=true}else{this.elements[t].selected=false}}else{if(this.elements[t].tagName.toLowerCase()=="input"&&jQuery(this.elements[t]).attr("type")=="checkbox"){if(J[0]===true){this.elements[t].checked=true}else{if(J[0]===false){this.elements[t].checked=false}else{if(J.indexOf(jQuery(this.elements[t]).next().text())!=-1){this.elements[t].checked=true}else{this.elements[t].checked=false}}}}else{if(this.elements[t].tagName.toLowerCase()=="div"){jQuery(this.elements[t]).text(J.join("; ")).siblings("textarea.ms-input:first").val(J.join("; "))}else{jQuery(this.elements[t]).val(J.join(""))}}}}}return this};var m=function(){var k=[];for(var t=0;t<this.elements.length;t++){if(this.elements[t].tagName.toLowerCase()=="option"){k.push(jQuery(this.elements[t]).parent());break}k.push(this.elements[t])}switch(k.length){case 0:return null;case 1:return jQuery(k[0]);default:return jQuery(k)}};var p=function(){return this.tr};var v=function(){return this.type};var E=null;for(var H=document.getElementsByTagName("table"),B=0,C=H.length;B<C;B++){if(H[B].className.search("ms-formtable")!=-1){E=H[B];break}}if(E==null){throw ("Error: unable to find the table.ms-formtable!")}var r=function(i){var k=i[0];do{k=k.parentNode}while(k.tagName!="TR");return jQuery(k)};var D=function(M){var N=M[0].getElementsByTagName("td")[1].getElementsByTagName("span")[0];var L=[];var I=N.getElementsByTagName("input");for(var J=0;J<I.length;J++){if(I[J].getAttribute("data-sp-ignore")!="true"){var K=I[J].getAttribute("type");switch(K){case"text":if(I[J].className.search("ms-input")!=-1||I[J].className.search("ms-long")!=-1){L=[I[J]];J=I.length}break;case"radio":L=[I[J]];J=I.length;break;case"checkbox":L.push(I[J]);break}}}if(L.length===0){var t=N.getElementsByTagName("select");for(J=0;J<t.length;J++){if(t[J].className.search("ms-RadioText")!=-1||(/_Lookup$|_SelectResult$|_SelectCandidate$|_SelectResult$/).test(t[J].id)){if(/_SelectCandidate$|_SelectResult$/.test(t[J].id)){L.push(t[J])}else{L=t[J].getElementsByTagName("option");break}}}}if(L.length===0){var k=N.getElementsByTagName("div");for(J=0;J<k.length;J++){if(k[J].className.search("ms-inputuserfield")!=-1){L=[k[J]];break}}if(L.length===0){k=N.getElementsByTagName("textarea");for(J=0;J<k.length;J++){if(k[J].className.search("ms-long")!=-1){L=[k[J]];break}}}}return L};var F=(y.length>0?y.length:1000);if(G.mandatory||G.calendar||G.people){F=1000}for(H=E.getElementsByTagName("nobr"),B=-1,C=H.length,done=0;B<C&&done<F;B++){var A,w,q,x,u=false;var n;if(B==-1){if(F==0||y.indexOf("Content Type")!=-1){q="Content Type";u=true}}else{tr=undefined;A=jQuery(H[B]);q=A.html();x=A.text();if(q.search("ms-formvalidation")!=-1){q=q.slice(0,-39);if(q.charAt(q.length-2)=="<"&&(q.charAt(q.length-1)=="s"||q.charAt(q.length-1)=="S")){q=q.slice(0,-2)}if(G.mandatory==true){u=true}x=x.slice(0,-2)}if(!u){if(G.calendar){tr=r(A);u=(tr.find('input[id$="DateTimeFieldDate"]').length>0)}if(!u&&G.people){if(tr===undefined){tr=r(A)}u=(tr.find('img[title="Check Names"]').length>0)}}if(!u){tr=undefined;if(F===1000&&G.length===0){u=true}else{if(F!==1000){for(var z=0,j=F;z<j;z++){if(jQuery.trim(y[z])==x){u=true;done++;break}}}}}}if(u){var h=q;var s={name:h,elements:null,values:null,tr:null,type:null};if(h!="Content Type"){s.tr=(tr===undefined?r(A):tr);s.elements=D(s.tr)}else{s.elements=jQuery('[title="Content Type"]');s.tr=r(s.elements)}s.values=[];s.val=l;s.elem=m;s.getType=v;s.row=p;jQuery.each(s.elements,function(i,I){var K=jQuery(I);if(I.tagName.toLowerCase()=="input"&&K.attr("type")=="checkbox"){var J="";s.type="checkbox";if(/BooleanField$/.test(K.attr("id"))){J=I.checked;s.type="boolean"}else{if(I.checked==true){J=K.next().text()}}if(J!==""){s.values.push(J)}}else{if(I.tagName.toLowerCase()=="option"||I.tagName.toLowerCase()=="select"){var t=(I.tagName.toLowerCase()=="option"?K.parent():K);if(/_SelectResult$/.test(t.attr("id"))){t.find("option").each(function(){s.values.push(jQuery(this).text())});s.type="multiple"}else{if(!/_SelectCandidate$/.test(t.attr("id"))){var J=(/_Lookup$/.test(t.attr("id"))?t.find("option:selected").text():t.val());if(jQuery.type(J)=="array"){jQuery.each(J,function(L,M){if(M!=""&&M!=undefined){s.values.push(M)}});s.type="multiple"}else{if(J!=""&&J!=undefined){s.values.push(J)}s.type="select"}}}}else{if(I.tagName.toLowerCase()=="div"){var J="";s.type="people";var k=K.closest("td.ms-formbody");J=((tmp=k.find("div#divEntityData").attr("key"))!=undefined?tmp:J);J=((tmp=k.find("input[id$='EntityKey']").val())!=undefined?tmp:J);if(J==""){J=K.text()}if(J==""){J=K.next().val()}J=(J==""?K.closest("span").children("input[id$='UserField_HiddenEntityDisplayText']").val():J);if(J!=""&&J!=null&&J!=undefined){s.values.push(J)}}else{if(I.tagName.toLowerCase()=="input"&&K.attr("type")=="radio"){s.type="radio";if(I.checked){s.values.push(K.next().text().replace(/^\s+/,"").replace(/\s+$/,""))}}else{s.type="text";if(/FieldDate$/.test(I.id)){s.type="date"}else{if(/UrlFieldUrl$/.test(I.id)){s.type="url"}}J=K.val();if(J!=""&&J!=undefined){s.values.push(J)}}}}}});if(s.type!="checkbox"&&s.type!="multiple"&&s.values.length==1){s.values=s.values[0]}else{if(s.values.length==0){s.values=""}}o.push(s)}}this.data=o;this.length=this.data.length;return this},val:function(m){if(m==undefined){var j=[];for(var i=0;i<this.data.length;i++){var l=this.data[i].val();if(jQuery.type(l)=="array"){jQuery.each(l,function(k,n){j.push(n)})}else{j.push(l)}}if(j.length==1){return j[0]}else{if(j.length==0){return""}else{return j}}}else{if(jQuery.type(m)=="string"||jQuery.type(m)=="boolean"||jQuery.type(m)=="number"){m=[m]}}if(jQuery.type(m)=="array"){for(var h=0;h<this.data.length;h++){this.data[h].val(m)}}return this},elem:function(){var h=[];for(var j=0;j<this.data.length;j++){jQuery.each(this.data[j].elem(),function(i,k){h.push(k)})}switch(h.length){case 0:return null;case 1:return jQuery(h[0]);default:return jQuery(h)}},row:function(){var h=[];for(var j=0;j<this.data.length;j++){jQuery.each(this.data[j].row(),function(i,k){h.push(k)})}switch(h.length){case 0:return null;case 1:return jQuery(h[0]);default:return jQuery(h)}},type:function(){var h=[];for(var j=0;j<this.data.length;j++){h.push(this.data[j].getType())}switch(h.length){case 0:return null;case 1:return h[0];default:return h}}};var d=(function(){var h=function(j){return new i(j)},i=function(j){this.mynode=j;this.singleList=true;return this};h.fn=i.prototype={getAttribute:function(j){return this.mynode.getAttribute("ows_"+j.replace(/ /g,""))},getAttributes:function(){return this.mynode.attributes}};return h})();var c=function(h){this.attributes=h};c.prototype.getAttribute=function(h){return this.attributes[h]};c.prototype.getAttributes=function(){return this.attributes};f.del=f.remove;return e.$SP=e.SharepointPlus=f})(window);